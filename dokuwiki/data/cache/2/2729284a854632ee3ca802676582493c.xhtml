
<h1 class="sectionedit1" id="modules">Modules</h1>
<div class="level1">

<p>
Les modules sont les composants de base de la chaine et peuvent aussi être la définition d&#039;une chaine. Ces modules sont définis par des fichiers ayant la forme suivante : NOM_MODULE.module
</p>

<p>
Les noms des modules sont des chaines de caractères respectant l&#039;expression régulière suivante : <strong>nom_module</strong> (@<strong><em>namespace</em></strong>)? où <strong>nom_module</strong> et <strong>namespace</strong> sont de la forme [a-zA-Z][a-zA-Z0-9_\-]+ (ex: <em>parser@user</em>, <em>mon-module-de-normalisation@hostname</em>, <em>parser_customisé</em> @domain, …)
</p>

<p>
Des modules déjà existant se trouvent dans la distribution dans le répertoire (relatif au répertoire d&#039;installation de <strong>cpm</strong>) modules/default et modules/addons.
</p>

</div>
<!-- EDIT1 SECTION "Modules" [1-698] -->
<h2 class="sectionedit2" id="description_fichier_module">Description (fichier .module)</h2>
<div class="level2">

<p>
Le fichier de description d&#039;un module est en format <a href="http://learnxinyminutes.com/docs/fr-fr/yaml-fr/" class="urlextern" title="http://learnxinyminutes.com/docs/fr-fr/yaml-fr/"  rel="nofollow">YAML</a>.
</p>

<p>
Les champs obligatoires sont :
</p>

<p>
- name : Le nom du module qui DOIT correspondre au nom de base du fichier (sans l&#039;extension .module). Ce nom doit etre unique entre tous les modules enregistrés (voir configuration, modules_dir).
</p>

<p>
- input : La liste des paramètres d&#039;entrée du module (voir plus bas)
</p>

<p>
- output : La liste des paramètres de sortie du module (voir plus bas)
</p>

<p>
- log : La liste des sorties de log du module
</p>

<p>
- exec : La liste des modules à exécuter (voir plus bas)
</p>

<p>
Il est possible de rajouter un champ “desc” qui contient une description utile du module affichée dans les différentes interfaces de <strong>cpm</strong>.
</p>

</div>
<!-- EDIT2 SECTION "Description (fichier .module)" [699-1478] -->
<h3 class="sectionedit3" id="input">Input</h3>
<div class="level3">

<p>
Les entrées d&#039;un module sont décrites via une <em>map</em> de la forme suivante :
</p>
<pre class="code">input :
  NOM_INPUT_1 :
    type  : INPUT_TYPE
    encoding : ENCODING (optionel, défaut étant utf-8)
    format : FORMAT (optionel)
    schema : SCHEMA (optionel)
    desc : description optionnelle
    value : valeur par défault optionnelle
  NOM_INPUT_2 :
    ...
  ...
  NOM_INPUT_N  :
...</pre>

<p>
Chaque <strong>input</strong><strong>/parametre </strong>à un <strong>nom unique</strong> dans le module et est donné en tant que clé pour sa description interne. Ce nom définit une <strong>variable</strong> (voir plus bas) réutilisable dans la description du module.
</p>

<p>
Ce nom DOIT respecter l&#039;expression régulière suivante : [A-Z][A-Z0-9_]*
</p>

<p>
Le seul parametre vraiment requis est le <strong>type </strong> du paramètre. Il en existe 4 qui seront décrit plus bas : <strong>VAL</strong>, <strong>FILE</strong>, <strong>DIR</strong>, <strong>CORPUS</strong>
</p>

<p>
Le type peut etre complémenté des quantificateurs suivants : * pour un nombre indéfini de valeurs, <strong>+</strong> pour un nombre strictement positif de valeurs et <strong>?</strong> pour une ou aucune valeur (paramètre optionnel)
</p>

</div>
<!-- EDIT3 SECTION "Input" [1479-2546] -->
<h3 class="sectionedit4" id="output">Output</h3>
<div class="level3">

<p>
Symmétriquement aux entrées d&#039;un module, les sorties sont décrites via une <em>map</em> de la forme suivante :
</p>
<pre class="code">output :
  NOM_OUTPUT_1 :
    type  : OUTPUT_TYPE
    encoding : ENCODING (optionel, défaut est utf-8)
    format : FORMAT (optionel)
    schema : SCHEMA (optionel)
    desc : description optionnelle
    value : valeur de sortie
  NOM_OUTPUT_2 :
    ...
  ...
  NOM_OUTPUT_N  :
...</pre>

<p>
Tout comme les entrées, chaque <strong>input</strong><strong>/parametre </strong>à un nom unique et le champ <strong>type</strong> a la même sémantique.
</p>

<p>
La différence se trouve dans l&#039;obligation de renseigner le champ <strong>val</strong><strong>ue</strong>.
</p>

</div>
<!-- EDIT4 SECTION "Output" [2547-3172] -->
<h3 class="sectionedit5" id="exec">Exec</h3>
<div class="level3">

<p>
Le champ <strong>run</strong> est un champ composé d&#039;une liste d&#039;<strong>instances</strong><strong> de</strong><strong> modules</strong> (<strong>moduleval</strong>) qui prend la forme suivante :
</p>
<pre class="code">exec :
  - nom-de-module-1.namespace-optionel-1 :
      input :
        INPUT-1 : VALEUR
        ...
      output :
        OUTPUT-1 : ALIAS
        ...
  - ...</pre>

<p>
Chaque <strong>instance de module</strong> est décrite par le <strong>nom du module</strong> postfixé optionnellement par un <strong>nom d&#039;espace/namespace </strong> précédé d&#039;un point “<strong>.</strong>”, si le module est réutilisé dans la définition d&#039;exécution afin d&#039;éviter les conflits dans les chemins d&#039;accès au variables.
</p>

<p>
Toutes ses entrées requises doivent être renseignée par des valeurs fixes ou composées de <strong>variables</strong>.
</p>

</div>
<!-- EDIT5 SECTION "Exec" [3173-3897] -->
<h3 class="sectionedit6" id="variables">Variables</h3>
<div class="level3">

<p>
Les variables sont des alias correspondant à des valeurs définies à l&#039;extérieur ou à l&#039;intérieur du module. Il en existe plusieurs types, celles définies par le <strong>nom des paramètres d&#039;entrée</strong>, les valeurs de <strong>sorties des modules exécutés</strong>, et quelques <strong>globales</strong> qui sont les suivantes :
</p>

<p>
- <strong>_DEF_DIR </strong>: le répertoire où se situe la définition du module
</p>

<p>
- <strong>_RUN_DIR</strong> : le répertoire dans lequel s&#039;éxecute le module
</p>

<p>
- <strong>ENC_DFT</strong> : l&#039;encodage par défaut des inputs
</p>

<p>
- <strong>_RUN_ID </strong>: l&#039;id du run courant
</p>

<p>
Les variables de <strong>sorties des modules éxécutés </strong> (qui se trouvent dans le champ <strong>run</strong>) sont accessible soit par leur “chemin d&#039;accès”, ie (<em>NOM_MODULE.NOM_OUTPUT</em>), ou par un alias/nom de variable assigné dans la descritption du <strong>run</strong>.
</p>

<p>
Les variables sont utilisées en préfixant le nom de la variable par le caractère <strong>$</strong>. Pour les variables “internes”, il faut encapsuler le chemin dans le patron <strong>${</strong><em>CHEMIN_ACCESS</em><strong>}</strong>.
</p>

</div>
<div class="level4">

</div>
<!-- EDIT6 SECTION "Variables" [3898-4905] -->
<h3 class="sectionedit7" id="log">Log</h3>
<div class="level3">

<p>
La définition des logs se fait sous la forme suivante :
</p>
<pre class="code">log :
  NOM_DU_LOG_0 : chemin d&#039;accès du log
  ...</pre>

</div>
<!-- EDIT7 SECTION "Log" [4906-5046] -->
<h2 class="sectionedit8" id="types_de_variables_parametres">Types de variables/paramètres</h2>
<div class="level2">

<p>
Chaque type de variable à une représentation par défaut sous forme de chaine de caractère. Certaines variables
</p>

</div>
<!-- EDIT8 SECTION "Types de variables/paramètres" [5047-5206] -->
<h3 class="sectionedit9" id="val_stream">VAL/STREAM</h3>
<div class="level3">

<p>
Les entrées de types <strong>VAL</strong> sont des chaines de caractères.
</p>

<p>
Par défaut, l&#039;encoding est <strong>utf-8</strong>
</p>

<p>
Représentation chaine de caractères : identité
</p>

</div>
<!-- EDIT9 SECTION "VAL/STREAM" [5207-5382] -->
<h3 class="sectionedit10" id="file">FILE</h3>
<div class="level3">

<p>
Défaut conversions : fromDir
</p>

<p>
Représentation chaine de caractère : chemin du fichier
</p>

<p>
variables internes :
</p>
<div class="table sectionedit11"><table class="inline">
	<tr class="row0">
		<td class="col0 leftalign"><strong>basedir</strong>   </td><td class="col1">parent directory path </td><td class="col2">VAL </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"><strong>basenam</strong><strong>e</strong>   </td><td class="col1">name of the file without last extension (.???) </td><td class="col2">VAL </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"><strong>filename</strong>   </td><td class="col1">filename </td><td class="col2">VAL </td>
	</tr>
</table></div>
<!-- EDIT11 TABLE [5510-5662] -->
</div>
<!-- EDIT10 SECTION "FILE" [5383-5663] -->
<h3 class="sectionedit12" id="dir">DIR</h3>
<div class="level3">

<p>
Représentation chaine de caractère : chemin du dossier
</p>

<p>
variables internes :
</p>
<div class="table sectionedit13"><table class="inline">
	<tr class="row0">
		<td class="col0 leftalign"><strong>ls</strong>   </td><td class="col1">list des fichiers directement enfants </td><td class="col2">FILE* </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"><strong>rls</strong>   </td><td class="col1">liste récursive de tous les fichiers </td><td class="col2">FILE* </td>
	</tr>
</table></div>
<!-- EDIT13 TABLE [5759-5875] -->
</div>
<!-- EDIT12 SECTION "DIR" [5664-5876] -->
<h3 class="sectionedit14" id="corpus">CORPUS</h3>
<div class="level3">

<p>
Représentation chaine de caractère : id du corpus
</p>

<p>
variables internes :
</p>
<div class="table sectionedit15"><table class="inline">
	<tr class="row0">
		<td class="col0 leftalign"><strong>ls</strong>   </td><td class="col1">liste de tous les fichiers du corpus </td><td class="col2">FILE* </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"><strong>dir</strong>   </td><td class="col1">répertoire racine du corpus </td><td class="col2">DIR </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"><strong>name</strong>   </td><td class="col1">nom du corpus </td><td class="col2">VAL </td>
	</tr>
</table></div>
<!-- EDIT15 TABLE [5970-6108] -->
</div>
<!-- EDIT14 SECTION "CORPUS" [5877-6109] -->
<h3 class="sectionedit16" id="module">MODULE</h3>
<div class="level3">

<p>
Représentation chaine de caractère : yaml représentation d&#039;un ModuleVal
</p>

</div>
<!-- EDIT16 SECTION "MODULE" [6110-6203] -->
<h3 class="sectionedit17" id="list_type_type">LIST[type] | type(+|*)</h3>
<div class="level3">

<p>
Représentation chaine de caractère : représentation en chaine de caractères des éléments séparés par des espaces OU représentation en liste yaml des représentations en chaine de caractère des éléments
</p>

</div>
<!-- EDIT17 SECTION "LIST[type] | type(+|*)" [6204-6452] -->
<h3 class="sectionedit18" id="map">MAP</h3>
<div class="level3">

<p>
Représentation en chaine de caractère : yaml map des représentation en chaine de caractères des éléments
</p>

</div>
<!-- EDIT18 SECTION "MAP" [6453-6579] -->
<h2 class="sectionedit19" id="modules_natifs_built-in_modules">Modules natifs / Built-in modules</h2>
<div class="level2">

<p>
Ces modules sont des modules dont l&#039;exécution (champ <em>run</em>) est intégrée directement dans le fonctionnement de <strong>cpm</strong>. Ils sont les briques de bases qui permettent de constituer des modules.
</p>

</div>
<!-- EDIT19 SECTION "Modules natifs / Built-in modules" [6580-6823] -->
<h3 class="sectionedit20" id="cmd">_CMD</h3>
<div class="level3">

<p>
Ce module permet tout simplement de lancer une commande.
</p>
<div class="table sectionedit21"><table class="inline">
	<tr class="row0">
		<td class="col0" colspan="3"><strong>Input</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>CMD</strong>   </td><td class="col2">VAL </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row2">
		<td class="col0" colspan="3"><strong>Output</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>STDOUT</strong>   </td><td class="col2">VAL </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row4">
		<td class="col0" colspan="3"><strong>Log</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>STDERR</strong>   </td><td class="col2">VAL </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row6">
		<td class="col0" colspan="3"><strong>Exec</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign">  </td><td class="col1" colspan="2">execute a shell command (with <strong>_RUN_WD</strong> </td><td class="col3">as working directory) </td>
	</tr>
</table></div>
<!-- EDIT21 TABLE [6898-7117] -->
</div>
<!-- EDIT20 SECTION "_CMD" [6824-7118] -->
<h3 class="sectionedit22" id="map1">_MAP</h3>
<div class="level3">

<p>
Ce module permet de distribuer parallèlement les fichiers d&#039;un corpus ou d&#039;un répertoire à un ensemble de processus ayant au moins une entrée de type FILE.
</p>
<div class="table sectionedit23"><table class="inline">
	<tr class="row0">
		<td class="col0" colspan="3"><strong>Input</strong> </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>IN</strong>   </td><td class="col2">FILE+ </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>RUN</strong>   </td><td class="col2">MODULE+ </td>
	</tr>
	<tr class="row3">
		<td class="col0" colspan="3"><strong>Output</strong> </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>OUT</strong>   </td><td class="col2">MAP </td>
	</tr>
	<tr class="row5">
		<td class="col0" colspan="3"><strong>Log</strong> </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>ERR</strong>   </td><td class="col2">MAP </td>
	</tr>
	<tr class="row7">
		<td class="col0" colspan="3"><strong>Exec</strong> </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign">  </td><td class="col1" colspan="2">execute in parallel the moduleval list on a files in the entry. produce a map of keyed modulenamespace outputs </td>
	</tr>
</table></div>
<!-- EDIT23 TABLE [7296-7560] -->
</div>
<!-- EDIT22 SECTION "_MAP" [7119-7561] -->
<h3 class="sectionedit24" id="loop">_LOOP</h3>
<div class="level3">

<p>
Ce module permet de distribuer séquentiellement les fichiers d&#039;un corpus ou d&#039;un répertoire à un ensemble de processus ayant au moins une entrée de type FILE.
</p>
<div class="table sectionedit25"><table class="inline">
	<tr class="row0">
		<td class="col0" colspan="3"><strong>Input</strong> </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>CMD</strong>   </td><td class="col2">VAL </td>
	</tr>
	<tr class="row2">
		<td class="col0" colspan="3"><strong>Output</strong> </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>STDOUT</strong>   </td><td class="col2">VAL </td>
	</tr>
	<tr class="row4">
		<td class="col0" colspan="3"><strong>Log</strong> </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>STDERR</strong>   </td><td class="col2">VAL </td>
	</tr>
	<tr class="row6">
		<td class="col0" colspan="3"><strong>Exec</strong> </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign">  </td><td class="col1 leftalign" colspan="2">  </td>
	</tr>
</table></div>
<!-- EDIT25 TABLE [7743-7878] -->
</div>
<!-- EDIT24 SECTION "_LOOP" [7562-7879] -->
<h3 class="sectionedit26" id="filter">_FILTER</h3>
<div class="level3">

<p>
Ce module permet de filter un ensemble de fichiers en un sous ensemble dépendant d&#039;une regex
</p>
<div class="table sectionedit27"><table class="inline">
	<tr class="row0">
		<td class="col0" colspan="3"><strong>Input</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>CMD</strong>   </td><td class="col2">VAL </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row2">
		<td class="col0" colspan="3"><strong>Output</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>STDOUT</strong>   </td><td class="col2">VAL </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row4">
		<td class="col0" colspan="3"><strong>Log</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>STDERR</strong>   </td><td class="col2">VAL </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row6">
		<td class="col0" colspan="3"><strong>Exec</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign">  </td><td class="col1" colspan="2">execute a shell command (with <strong>_RUN_WD</strong> </td><td class="col3">as working directory) </td>
	</tr>
</table></div>
<!-- EDIT27 TABLE [7994-8213] -->
</div>
<!-- EDIT26 SECTION "_FILTER" [7880-8214] -->
<h3 class="sectionedit28" id="splitter">_SPLITTER</h3>
<div class="level3">

<p>
Ce module permet de filter le contenu d&#039;un fichier via une regex et de créer une liste de fichier contenant les éléments filtrés
</p>
<div class="table sectionedit29"><table class="inline">
	<tr class="row0">
		<td class="col0" colspan="3"><strong>Input</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>CMD</strong>   </td><td class="col2">VAL </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row2">
		<td class="col0" colspan="3"><strong>Output</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>STDOUT</strong>   </td><td class="col2">VAL </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row4">
		<td class="col0" colspan="3"><strong>Log</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign">  </td><td class="col1 leftalign"><strong>STDERR</strong>   </td><td class="col2">VAL </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row6">
		<td class="col0" colspan="3"><strong>Exec</strong> </td><td class="col3 leftalign">  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign">  </td><td class="col1" colspan="2">execute a shell command (with <strong>_RUN_WD</strong> </td><td class="col3">as working directory) </td>
	</tr>
</table></div>
<!-- EDIT29 TABLE [8370-8589] -->
</div>
<!-- EDIT28 SECTION "_SPLITTER" [8215-8590] -->
<h2 class="sectionedit30" id="formats_schemas">Formats / Schemas</h2>
<div class="level2">

</div>
<!-- EDIT30 SECTION "Formats / Schemas" [8591-8621] -->
<h3 class="sectionedit31" id="formats">Formats</h3>
<div class="level3">

<p>
Le format est la syntaxe d&#039;une donnée. Pour le texte il s&#039;agit principalement de : tabular/CSV, xml, json, yaml ou autre personnelle
</p>

<p>
Il doit etre possible de convertir automatiquement certains formats en d&#039;autres (par exemple yaml&lt;→json&lt;→xml).
</p>

</div>
<!-- EDIT31 SECTION "Formats" [8622-8891] -->
<h3 class="sectionedit32" id="schema">Schema</h3>
<div class="level3">

<p>
Le schema définit la sémantique d&#039;une donnée. Par exemple : passage, depxml, ConLL, stanford, etc.
</p>

<p>
Les schemas sont combinables, certains sont implicitement mutuellement exclusifs. On ne verifiera pas la mutuel exclusion.
</p>

<p>
Ainsi nous avons défini les formats suivants : Annotation qui est définit par un contenu (texte d&#039;un xml) dont des spans sont annotés, et CAS qui en xml a des champs specifiques pour déclarer des annotations globales au document et des annotations sur des parties d&#039;un texte original.
</p>

</div>
<!-- EDIT32 SECTION "Schema" [8892-9426] -->
<h3 class="sectionedit33" id="encoding">Encoding</h3>
<div class="level3">

<p>
L&#039;encoding est l&#039;information qui permet de décoder le signal de base (bits) en des structures informatique natives (char,int,etc.) bas niveau.
</p>

<p>
La variable <strong>ENC_DFT</strong> (qui peut etre overridé dans la configuration de run) définit la valeur par défaut qui est pour le texte : l&#039;utf-8
</p>

</div>
<div class="level3">

</div>
<!-- EDIT33 SECTION "Encoding" [9427-9746] -->
<h2 class="sectionedit34" id="gestion_des_dependances">Gestion des dépendances</h2>
<div class="level2">

<p>
- all in a folder static linking (big module in memory size.., possible redundance with other modules…)
</p>

<p>
- compose your own docker (using the base one with cpm-process-shell as entrypoint)
</p>

</div>
<!-- EDIT34 SECTION "Gestion des dépendances" [9747-9976] -->
<h2 class="sectionedit35" id="modules_supplementaires_addons_modules">Modules supplémentaires / Addons modules</h2>
<div class="level2">

<p>
toUTF8
</p>

<p>
toLatin1
</p>

<p>
jsonToXML
</p>

<p>
XMLtoJSON
</p>

<p>
xml_merger
</p>

</div>
<!-- EDIT35 SECTION "Modules supplémentaires / Addons modules" [9977-10083] -->
<h2 class="sectionedit36" id="examples">Examples</h2>
<div class="level2">

<p>
à venir :
</p>

<p>
- stanford-parser + wolf + unitex in parallel, merging job with xml_merger (basic use _map, _cmd, _filter, etc.)
</p>

<p>
- chaine pulsar
</p>

<p>
<br/>

</p>

</div>
<!-- EDIT36 SECTION "Examples" [10084-] -->