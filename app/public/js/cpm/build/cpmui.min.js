/*! cpmui 04-12-2015 */
!function(a){a.cpm={}}(window.vw=window.vw||{}),function(a){a.cpm.CLI=function(b,c){this.options=c,this.view=new a.cpm.CLIView(this,b),this.init()},a.cpm.CLI.prototype.init=function(){var b=this;this.activemenu="",this.menus={"default":{title:"Corpus & Process Manager",body:$("<div></div>")},"corpus-menu":{title:"Corpora",body:$("<div></div>")},"module-menu":{title:"Modules",body:$("<div></div>")},"process-menu":{title:"Process",body:$("<div></div>")},"settings-menu":{title:"Settings",body:$("<div></div>")},"help-menu":{title:"Help",body:$("<div></div>")}},this.helpmanager=new a.cpm.HelpManager(this,this.menus["help-menu"].body),this.corpusmanager=new a.cpm.CorpusManager(this,this.menus["corpus-menu"].body),this.cpmCall("settings",function(a){var c="";c+="<div> Result directory : "+a.result_dir+"</div>",c+="<div> Corpus directory : "+a.corpus_dir+"</div>";for(var d="<div>",e=a.modules.length-1;e>=0;e--)d+="<span ",d+=a.modules[e].exist?'style="color:green">':'style="color:red">',d+=a.modules[e].name+"</span>";d+="</div>",c+=d,b.menus["settings-menu"].body=c})},a.cpm.CLI.prototype.setActiveMenu=function(a){this.view.$el.find("#menu-content-title").empty(),this.view.$el.find("#menu-content-body").children().detach();var b=this.menus[a];this.view.$el.find("#menu-content-title").append(b.title),this.view.$el.find("#menu-content-body").append(b.body)},a.cpm.CLI.prototype.cpmCall=function(a,b){var c=this;$.ajax({type:"POST",data:{cmd:a+" --json"},url:c.options.cpmbaseurl+"rest/cmd",dataType:"json",success:function(a,d,e){b.call(c,a)},error:function(){}})},a.cpm.CLI.prototype.request=function(b){var c=this;if("test"!=b)c.cpmCall(b,function(a){c.view.createPanel(b,a),console.log(a)});else{var d=this.view.createPanel();new a.cpm.Module(this,d.find(".frame-body"),{name:"pipeline-test"})}},a.cpm.CLI.prototype.cpmSettings=function(){}}(window.vw=window.vw||{}),function(a){a.cpm.utils={},a.cpm.utils.guids=[],a.cpm.utils.guid=function(){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}for(var c=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();-1!=a.cpm.utils.guids.indexOf(c);)c=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();return a.cpm.utils.guids.push(c),c}}(window.vw=window.vw||{}),function(a){a.cpm.CorpusManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.CorpusManagerView(this,c),this.filetree={},this.init()},a.cpm.CorpusManager.prototype.init=function(){var a=this;a.sync()},a.cpm.CorpusManager.prototype.sync=function(){var a=this;$.ajax({type:"POST",url:a.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"corpus ls --json"},dataType:"json",success:function(b,c,d){a.filetree=b,a.view.refresh()}})}}(window.vw=window.vw||{}),function(a){a.cpm.HelpManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.HelpManagerView(this,c),this.init()},a.cpm.HelpManager.prototype.init=function(){}}(window.vw=window.vw||{}),function(a){a.cpm.Module=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.ModuleView(this,c)},a.cpm.Module.prototype.init=function(){}}(window.vw=window.vw||{}),function(a){a.cpm.ModuleManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.ModuleView(this,c)},a.cpm.ModuleManager.prototype.init=function(){}}(window.vw=window.vw||{}),function(a){a.cpm.CLIView=function(a,b){this.$el=b,this.el=b[0],this.model=a,this.init(),this.panels=[]},a.cpm.CLIView.maxFrameHeight=500,a.cpm.CLIView.prototype.init=function(){var b=this;a.cpm.CLIView.maxFrameHeight=$(window).height()-154,$("#cmd-bar-container").perfectScrollbar({suppressScrollX:!0}),$("#menu-content-body").css("height",window.innerHeight-80),$("#menu-content-body").perfectScrollbar(),$(window).on("resize",function(){$("#menu-content-body").css("height",window.innerHeight-80),$("#menu-content-body").perfectScrollbar(),a.cpm.CLIView.maxFrameHeight=$(window).height()-154}),this.contentpanel=$("#active-content"),this.cmdbar=$("#cmdbar").cmd({prompt:"$",width:"100%",commands:function(a){console.log(a),console.log(this),b.model.request(a)}}),jQuery("#menu").click(function(){b.toggleCLI(!1)}),jQuery("#app-title").click(function(){b.toggleCLI(!1),jQuery("#main").hasClass("menu-closed")&&(b.model.activemenu="default",b.model.setActiveMenu("default")),jQuery("#main.menu-open").switchClass("menu-open","menu-closed"),jQuery("#main.menu-closed").switchClass("menu-closed","menu-open")}),$(".main-menu-item").click(function(){b.model.activemenu==this.id?(jQuery("#main.menu-open").switchClass("menu-open","menu-closed"),jQuery("#main.menu-closed").switchClass("menu-closed","menu-open")):(jQuery("#main.menu-closed").switchClass("menu-closed","menu-open"),b.model.setActiveMenu(this.id),b.model.activemenu=this.id)}),jQuery("#active-content").on("click",function(){b.toggleCLI(!1)}),jQuery("#cmd-bar-container").on("click",function(){b.toggleCLI(!0)})},a.cpm.CLIView.prototype.toggleCLI=function(a){"undefined"!=a?a?this.cmdbar.isenabled()||this.cmdbar.enable():this.cmdbar.isenabled()&&this.cmdbar.disable():this.cmdbar.isenabled()?this.cmdbar.disable():this.cmdbar.enable()},a.cpm.CLIView.prototype.stick=function(a){var b=this;a.detach(),this.contentpanel.find("#active-content-sticky").append(a);var c=a.find(".frame-tool-pin");c.removeClass("frame-tool-pin"),c.addClass("frame-tool-unpin"),c.unbind("click"),c.click(function(){b.unstick(a)})},a.cpm.CLIView.prototype.unstick=function(a){var b=this;a.detach(),this.contentpanel.find("#active-content-flow").append(a);var c=a.find(".frame-tool-unpin");c.removeClass("frame-tool-unpin"),c.addClass("frame-tool-pin"),c.unbind("click"),c.click(function(){b.stick(a)})},a.cpm.CLIView.prototype.createPanel=function(b,c){var d=this,e=a.cpm.CLIView.frametemplate,f=$(e);return this.contentpanel.find("#active-content-flow").prepend(f),"undefined"!=b&&f.find(".frame-title").append(b),"undefined"!=c&&f.find(".frame-body").append(c),this.panels.push(f),f.find(".frame-tool-pin").click(function(){d.stick(f)}),f.find(".frame-tool-close").click(function(){var a=d.panels.indexOf(f);-1!=a&&d.panels.splice(a,1),f.remove()}),f},a.cpm.CLIView.frametemplate='<div class="frame"><div class="frame-header"><div class="frame-title"></div><div class="frame-tools"><div class="frame-tool frame-tool-close"></div><div class="frame-tool frame-tool-pin"></div></div></div><div class="frame-body"></div></div>'}(window.vw=window.vw||{}),function(a){function b(a,b){var c=typeof a,d=typeof b;return a.hasOwnProperty("...")?-1:b.hasOwnProperty("...")?1:c!=d?"string"==c?-1:"string"==d?1:0:0}a.cpm.CorpusManagerView=function(a,b){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.model=a,this.init()},a.cpm.CorpusManagerView.prototype.init=function(){},a.cpm.CorpusManagerView.prototype.refresh=function(){this.$el.html(a.cpm.CorpusManagerView.renderSubTree(this.model.filetree,0)),this.$el.find(".treeview-node").on("click",function(){var a=$(this).parent();if(a.hasClass("treeview-fold")){var b=a.children();a.hasClass("treeview-folded")?($(b[1]).slideDown(),a.removeClass("treeview-folded"),a.addClass("treeview-unfolded")):($(b[1]).slideUp(),a.removeClass("treeview-unfolded"),a.addClass("treeview-folded"))}}),this.$el.find(".treeview-node").draggable({appendTo:"body",opacity:.7,helper:"clone"}),this.$el.find(".treeview-node").droppable()},a.cpm.CorpusManagerView.renderSubTree=function(c,d){var e="";if("object"==typeof c)if(c.constructor===Array){c=c.sort(b);for(var f=c.length-1;f>=0;f--)e+=a.cpm.CorpusManagerView.renderSubTree(c[f],d)}else for(var f in c)if("..."==f)e+="file"==c[f]?'<div class="treeview-leaf treeview-more" style="margin-left:'+d+'px;">'+f+"</div>":'<div class="treeview-node treeview-more" style="margin-left:'+d+'px;">'+f+"</div>";else{var g="treeview-folded",h='style="display:none;"';0==d&&(g="treeview-unfolded",h=""),e+='<div class="treeview-fold '+g+'"><div class="treeview-node" style="margin-left:'+d+'px;">'+f+"</div><div "+h+">"+a.cpm.CorpusManagerView.renderSubTree(c[f],d+14)+"</div></div>"}else"string"==typeof c&&(e+='<div class="treeview-leaf" style="margin-left:'+d+'px;">'+c+"</div>");return e}}(window.vw=window.vw||{}),function(a){a.cpm.HelpManagerView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.HelpManagerView.prototype.init=function(){var b=this;this.$el.append(a.cpm.HelpManagerView.template),this.$el.find("#help-module-doc").on("click",function(){b.model.app.view.createPanel("Modules doc page",'<iframe width="100%" height="'+a.cpm.CLIView.maxFrameHeight+'px;" style="border:none;" src="https://versatile-world.net/wiki/work/cpm/spec_draft?rev=1445003156&mddo=print">')}),this.$el.find("#help-main-wiki-page").on("click",function(){b.model.app.view.createPanel("Main wiki page",'<iframe width="100%" height="'+a.cpm.CLIView.maxFrameHeight+'px;" style="border:none;" src="https://versatile-world.net/wiki/work/cpm">')})},a.cpm.HelpManagerView.template='<div id="help-main-wiki-page" style="cursor:pointer;">Main wiki</div><div id="help-module-doc" style="cursor:pointer;">Modules</div>'}(window.vw=window.vw||{}),function(a){a.cpm.ModuleManagerView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.ModuleManagerView.prototype.init=function(){}}(window.vw=window.vw||{}),function(a){a.cpm.ModuleView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.ModuleView.prototype.init=function(){var a=this;this.$el.append('<div id="'+this.id+'" class="canvas-view"></div>');var b=new draw2d.Canvas(a.id),c=new draw2d.shape.basic.Rectangle;b.add(c,100,10)}}(window.vw=window.vw||{});