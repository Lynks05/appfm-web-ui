/*! cpmui 02-12-2015 */
!function(a){a.cpm={}}(window.vw=window.vw||{}),function(a){a.cpm.CLI=function(b,c){this.options=c,this.view=new a.cpm.CLIView(this,b),this.init()},a.cpm.CLI.prototype.init=function(){var b=this;this.menus={"default":{title:"Corpus & Process Manager",body:"???"},"corpus-menu":{title:"Corpora",body:$("<div></div>")},"module-menu":{title:"Modules",body:"???"},"process-menu":{title:"Process",body:"???"},"settings-menu":{title:"Settings",body:"???"},"help-menu":{title:"Help",body:"???"}},this.corpusmanager=new a.cpm.CorpusManager(this,this.menus["corpus-menu"].body),this.cpmCall("settings",function(a){var c="";c+="<div> Result directory : "+a.result_dir+"</div>",c+="<div> Corpus directory : "+a.corpus_dir+"</div>";for(var d="<div>",e=a.modules.length-1;e>=0;e--)d+="<span ",d+=a.modules[e].exist?'style="color:green">':'style="color:red">',d+=a.modules[e].name+"</span>";d+="</div>",c+=d,b.menus["settings-menu"].body=c})},a.cpm.CLI.prototype.setActiveMenu=function(a){this.view.$el.find("#menu-content-title").empty(),this.view.$el.find("#menu-content-body").empty();var b=this.menus[a];this.view.$el.find("#menu-content-title").append(b.title),this.view.$el.find("#menu-content-body").append(b.body)},a.cpm.CLI.prototype.cpmCall=function(a,b){var c=this;$.ajax({type:"POST",data:{cmd:a+" --json"},url:c.options.cpmbaseurl+"rest/cmd",dataType:"json",success:function(a,d,e){b.call(c,a)},error:function(){}})},a.cpm.CLI.prototype.request=function(b){var c=this;if("test"!=b)c.cpmCall(b,function(a){c.view.createPanel(b,a),console.log(a)});else{var d=this.view.createPanel();new a.cpm.Module(this,d.find(".frame-body"),{name:"pipeline-test"})}},a.cpm.CLI.prototype.cpmSettings=function(){}}(window.vw=window.vw||{}),function(a){a.cpm.utils={},a.cpm.utils.guids=[],a.cpm.utils.guid=function(){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}for(var c=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();-1!=a.cpm.utils.guids.indexOf(c);)c=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();return a.cpm.utils.guids.push(c),c}}(window.vw=window.vw||{}),function(a){a.cpm.CorpusManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.CorpusManagerView(this,c),this.filetree={},this.init()},a.cpm.CorpusManager.prototype.init=function(){var a=this;a.sync()},a.cpm.CorpusManager.prototype.sync=function(){var a=this;$.ajax({type:"POST",url:a.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"corpus ls --json"},dataType:"json",success:function(b,c,d){a.filetree=b,a.view.refresh()}})}}(window.vw=window.vw||{}),function(a){a.cpm.Module=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.ModuleView(this,c)},a.cpm.Module.prototype.init=function(){}}(window.vw=window.vw||{}),function(a){a.cpm.ModuleManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.ModuleView(this,c)},a.cpm.ModuleManager.prototype.init=function(){}}(window.vw=window.vw||{}),function(a){a.cpm.CLIView=function(a,b){this.$el=b,this.el=b[0],this.model=a,this.init(),this.panels=[]},a.cpm.CLIView.prototype.init=function(){var a=this;$("#cmd-bar-container").perfectScrollbar({suppressScrollX:!0}),$("#menu-content-body").css("height",window.innerHeight-80),$("#menu-content-body").perfectScrollbar(),$(window).on("resize",function(){$("#menu-content-body").css("height",window.innerHeight-80),$("#menu-content-body").perfectScrollbar()}),this.contentpanel=$("#active-content"),this.cmdbar=$("#cmdbar").cmd({prompt:"$",width:"100%",commands:function(b){console.log(b),console.log(this),a.model.request(b)}}),jQuery("#menu").click(function(){a.toggleCLI(!1)}),jQuery("#app-title").click(function(){a.toggleCLI(!1),jQuery("#main").hasClass("menu-closed")&&0==a.$el.find("#menu-content-title").children().length&&a.model.setActiveMenu("default"),jQuery("#main.menu-open").switchClass("menu-open","menu-closed"),jQuery("#main.menu-closed").switchClass("menu-closed","menu-open")}),$(".main-menu-item").click(function(){jQuery("#main.menu-closed").switchClass("menu-closed","menu-open"),a.model.setActiveMenu(this.id)}),jQuery("#active-content").on("click",function(){a.toggleCLI(!1)}),jQuery("#cmd-bar-container").on("click",function(){a.toggleCLI(!0)})},a.cpm.CLIView.prototype.toggleCLI=function(a){"undefined"!=a?a?this.cmdbar.isenabled()||this.cmdbar.enable():this.cmdbar.isenabled()&&this.cmdbar.disable():this.cmdbar.isenabled()?this.cmdbar.disable():this.cmdbar.enable()},a.cpm.CLIView.prototype.stick=function(a){var b=this;a.detach(),this.contentpanel.find("#active-content-sticky").append(a);var c=a.find(".frame-tool-pin");c.removeClass("frame-tool-pin"),c.addClass("frame-tool-unpin"),c.unbind("click"),c.click(function(){b.unstick(a)})},a.cpm.CLIView.prototype.unstick=function(a){var b=this;a.detach(),this.contentpanel.find("#active-content-flow").append(a);var c=a.find(".frame-tool-unpin");c.removeClass("frame-tool-unpin"),c.addClass("frame-tool-pin"),c.unbind("click"),c.click(function(){b.stick(a)})},a.cpm.CLIView.prototype.createPanel=function(b,c){var d=this,e=a.cpm.CLIView.frametemplate,f=$(e);return this.contentpanel.find("#active-content-flow").prepend(f),"undefined"!=b&&f.find(".frame-title").append(b),"undefined"!=c&&f.find(".frame-body").append(c),this.panels.push(f),f.find(".frame-tool-pin").click(function(){d.stick(f)}),f.find(".frame-tool-close").click(function(){var a=d.panels.indexOf(f);-1!=a&&d.panels.splice(a,1),f.remove()}),f},a.cpm.CLIView.frametemplate='<div class="frame"><div class="frame-header"><div class="frame-title"></div><div class="frame-tools"><div class="frame-tool frame-tool-close"></div><div class="frame-tool frame-tool-pin"></div></div></div><div class="frame-body"></div></div>'}(window.vw=window.vw||{}),function(a){a.cpm.CorpusManagerView=function(a,b){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.model=a,this.init()},a.cpm.CorpusManagerView.prototype.init=function(){},a.cpm.CorpusManagerView.prototype.refresh=function(){this.$el.html(a.cpm.CorpusManagerView.renderSubTree(this.model.filetree,0))},a.cpm.CorpusManagerView.renderSubTree=function(b,c){var d="";if("object"==typeof b)if(b.constructor===Array)for(var e=b.length-1;e>=0;e--)d+=a.cpm.CorpusManagerView.renderSubTree(b[e],c);else for(var e in b)d+='<div class="treeview-node" style="margin-left:'+c+'px;">'+e+"</div>"+a.cpm.CorpusManagerView.renderSubTree(b[e],c+12);else"string"==typeof b&&(d+='<div class="treeview-leaf" style="margin-left:'+c+'px;">'+b+"</div>");return d}}(window.vw=window.vw||{}),function(a){a.cpm.ModuleManagerView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.ModuleManagerView.prototype.init=function(){}}(window.vw=window.vw||{}),function(a){a.cpm.ModuleView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.ModuleView.prototype.init=function(){var a=this;this.$el.append('<div id="'+this.id+'" class="canvas-view"></div>');var b=new draw2d.Canvas(a.id),c=new draw2d.shape.basic.Rectangle;b.add(c,100,10)}}(window.vw=window.vw||{});