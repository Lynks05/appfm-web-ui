/*! cpmui 21-01-2016 */
!function(a){a.cpm={}}(window.vw=window.vw||{}),function(a){}(window.vw=window.vw||{}),function(a){a.cpm.CLI=function(b,c){this.options=c,this.view=new a.cpm.CLIView(this,b),this.init()},a.cpm.CLI.prototype.init=function(){var b=this;this.foo="bar",store.enabled||alert('Local storage is not supported by your browser. Please disable "Private Mode", or upgrade to a modern browser. Your session won\'t be saved across page reloads'),console.log(store.get("test")),store.set("test",this.view.panels),this.activemenu="",this.menus={"default":{title:"Application Frame Mngr",body:$("<div></div>")},"corpus-menu":{title:"Corpora",body:$("<div></div>")},"module-menu":{title:"Modules",body:$("<div></div>")},"process-menu":{title:"Process",body:$("<div></div>")},"settings-menu":{title:"Settings",body:$("<div></div>")},"help-menu":{title:"Help",body:$("<div></div>")}},this.cpmsettingsmanager=new a.cpm.CPMSettingsManager(this,this.menus["settings-menu"].body,{init:function(){b.initmodules()}}),this.helpmanager=new a.cpm.HelpManager(this,this.menus["help-menu"].body);var c=store.get("firstrun");if(c){this.view.createPanel("Intro",this.helpmanager.slides)}else{this.view.createPanel("Intro",this.helpmanager.slides);b.demo(),store.set("firstrun","done")}},a.cpm.CLI.prototype.initmodules=function(){this.modulesmanager=new a.cpm.ModuleManager(this,this.menus["module-menu"].body),this.corpusmanager=new a.cpm.CorpusManager(this,this.menus["corpus-menu"].body),this.processmanager=new a.cpm.ProcessManager(this,this.menus["process-menu"].body)},a.cpm.CLI.prototype.setActiveMenu=function(a){this.view.$el.find("#menu-content-title").empty(),this.view.$el.find("#menu-content-body").children().detach();var b=this.menus[a];this.view.$el.find("#menu-content-title").append(b.title),this.view.$el.find("#menu-content-body").append(b.body)},a.cpm.CLI.prototype.cpmRawCall=function(a,b){var c=this;$.ajax({type:"POST",data:{cmd:a},url:c.options.cpmbaseurl+"rest/cmd",success:function(a,d,e){b.call(c,a)},error:function(){}})},a.cpm.CLI.prototype.cpmCall=function(a,b){var c=this;$.ajax({type:"POST",data:{cmd:a+" --json"},url:c.options.cpmbaseurl+"rest/cmd",dataType:"json",success:function(a,d,e){b.call(c,a)},error:function(){}})},a.cpm.CLI.prototype.request=function(b){var c=this;if(b=b.trim(),"test"==b){var d=this.view.createPanel("test");new a.cpm.Process(this,d.find(".frame-body"),{moduledef:c.modulesmanager.modules["stanford-parser"],runconf:{IN:"/home/paul/custom/cpm/data/testcorpus/humanism.txt"},runid:"some run id"})}if("help"==b)return void c.helpmanager.displayCLIHelp();if("brat"==b)return d=c.view.getPanel("brat"),d.find(".frame-body").empty(),void d.find(".frame-body").append('<iframe style="border-style:none;border:0;margin:0;padding:0;" width="100%" height="500px" src="http://'+c.options.hostname+':8001/index.xhtml"></iframe>');if(b.startsWith("file")){var e=b.split(" ");return void c.openFile(e[1])}c.cpmRawCall(b,function(a){c.view.createPanel(b,a),console.log(a)})},a.cpm.CLI.prototype.openFile=function(a){var b=this;$.ajax({type:"POST",data:{file:a},url:b.options.cpmbaseurl+"rest/file",success:function(c,d,e){c=jQuery("<div />").text(c).html(),c='<code><pre class="pre-wrapped">'+c+"</pre></code>",b.view.createPanel(a,c)},error:function(){}})},a.cpm.CLI.prototype.getFileContent=function(a,b){var c=this;$.ajax({type:"POST",data:{file:a},url:c.options.cpmbaseurl+"rest/file",success:function(a,d,e){b.call(c,a)},error:function(){}})},a.cpm.CLI.prototype.cpmSettings=function(){},a.cpm.CLI.prototype.demo=function(){var a=this,b=introJs();b.setOptions({steps:[{intro:"<h1>Welcome to AppFM</h1>the Application Frame Manager for NLP!<br>This short tutorial will present you the basic interface."},{element:document.querySelector("#cmd-bar-container"),intro:"This is the command bar. It sends direct raw command to the server.",position:"bottom"},{element:document.querySelectorAll(".frame")[0],intro:"Results of most commands are displayed in windows frame within content flow.",position:"bottom"},{element:document.querySelector("#corpus-menu"),intro:"There is 3 main menus. This first one show a list of all corpus handled by AppFM.",position:"right"},{element:document.querySelector("#module-menu"),intro:"This one list the modules available that can be executed over the data available in the previous menu.",position:"right"},{element:document.querySelector("#process-menu"),intro:"This last one shows the list of past modules executions.",position:"right"},{element:document.querySelector("#settings-menu"),intro:"Global settings can be reviewed here.",position:"right"},{element:document.querySelector("#help-menu"),intro:"...and if you need more help, this is where you can find further documentation.",position:"right"}]}),b.onchange(function(b){"corpus-menu"==b.id?a.view.openMenu("corpus-menu"):"module-menu"==b.id?a.view.openMenu("module-menu"):"process-menu"==b.id?a.view.openMenu("process-menu"):"settings-menu"==b.id?a.view.openMenu("settings-menu"):"help-menu"==b.id&&a.view.openMenu("help-menu")}),b.onexit(function(){a.view.closeMenu()}),b.oncomplete(function(){a.view.closeMenu()}),b.start()}}(window.vw=window.vw||{}),function(a){a.cpm.ui={},a.cpm.ui.Modal=function(){var b=this;this.$el=$(a.cpm.ui.Modal.template),this.$el.find(".cpm-modal-close").click(function(){b.close()}),this.$el.find(".cpm-modal-content").perfectScrollbar({suppressScrollY:!0}),this.$el.hide()},a.cpm.ui.Modal.prototype.open=function(b){return a.cpm.ui.Modal.alreadyExist?void console.log("error : a modal is already open! this is a quick handmade framework that doesn't handle multiple opened modals.."):(a.cpm.ui.Modal.alreadyExist=!0,$modalbg=$('<div id="cpm-modal-bg"></div>'),$("body").append($modalbg),$modalbg.perfectScrollbar(),this.$el.find(".cpm-modal-content").append(b),$modalbg.append(this.$el),void this.$el.slideDown())},a.cpm.ui.Modal.prototype.getContainer=function(){return this.$el.find(".cpm-modal-content")},a.cpm.ui.Modal.prototype.close=function(){this.$el.slideUp({complete:function(){$("body").find("#cpm-modal-bg").remove(),a.cpm.ui.Modal.alreadyExist=!1}})},a.cpm.ui.Modal.alreadyExist=!1,a.cpm.ui.Modal.template='<div class="cpm-modal"><div class="cpm-modal-header"><div class="cpm-modal-close"></div></div><div class="cpm-modal-content"></div></div>'}(window.vw=window.vw||{}),function(a){a.cpm.utils={},a.cpm.utils.guids=[],a.cpm.utils.guid=function(){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}for(var c=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();-1!=a.cpm.utils.guids.indexOf(c);)c=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();return a.cpm.utils.guids.push(c),c},a.cpm.utils.getSelectionText=function(){var a="";return window.getSelection?a=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(a=document.selection.createRange().text),a},a.cpm.utils.getParentDir=function(a){var b=a.lastIndexOf("/");return-1!=b?a.substring(0,b):a}}(window.vw=window.vw||{}),function(a){a.cpm.CorpusManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.CorpusManagerView(this,c),this.filetree={},this.init()},a.cpm.CorpusManager.prototype.init=function(){var a=this;a.fetch()},a.cpm.CorpusManager.prototype.fetch=function(){var a=this;a.lsDir(a.app.cpmsettingsmanager.cpmsettings.corpus_dir,0,function(b){a.view.renderCorpora(b)}),a.lsDir(a.app.cpmsettingsmanager.cpmsettings.result_dir,0,function(b){a.view.renderResults(b)})},a.cpm.CorpusManager.prototype.lsDir=function(a,b,c){var d=this;$.ajax({type:"POST",url:d.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"corpus lsdir "+a+" "+b},dataType:"json",success:function(b,e,f){c.call(d,b,a)}})}}(window.vw=window.vw||{}),function(a){a.cpm.CPMSettingsManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.CPMSettingsManagerView(this,c),this.cpmsettings={},this.init()},a.cpm.CPMSettingsManager.prototype.init=function(a){var b=this;b.fetch()},a.cpm.CPMSettingsManager.prototype.fetch=function(a){var b=this;this.app.cpmCall("settings",function(a){b.cpmsettings=a;for(var c=0;c<a.modules.length;c++)if(a.modules[c].exist){b.defaultModulesDir=a.modules[c].name;break}b.view.render(),b.options.init&&b.options.init.call(b.app)})}}(window.vw=window.vw||{}),function(a){a.cpm.HelpManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.HelpManagerView(this,c),this.init()},a.cpm.HelpManager.prototype.init=function(){this.slides='<iframe style="border-style:none;border:0;margin:0;padding:0;" height="500px" width="100%" src="'+this.app.options.cpmbaseurl+'public/doc/slides/index.html"></iframe>'},a.cpm.HelpManager.prototype.displayCLIHelp=function(){var a="todo.. :/";this.app.view.createPanel("help",a)}}(window.vw=window.vw||{}),function(a){a.cpm.Module=function(b,c,d){this.def=d,this.app=b,this.view=new a.cpm.ModuleView(this,c),this.synced=!1},a.cpm.Module.prototype.init=function(){},a.cpm.Module.prototype.fetch=function(){},a.cpm.Module.prototype.sync=function(b,c){var d=this;d.def.source=d.view.editor.getValue();var e="update "+d.def.modulename;d.def.creation&&(e="create "+d.def.modulename+" "+a.cpm.utils.getParentDir(d.def.sourcepath)),console.log(d.def),$.ajax({type:"POST",data:{cmd:"module "+e,data:d.def.source},url:d.app.options.cpmbaseurl+"rest/cmd",dataType:"json",success:function(a,b,c){a.success?d.def.creation&&(d.app.modulesmanager.fetchAll(),delete d.def.creation):alert(d.error)},error:function(){}})},a.cpm.Module.confToYaml=function(a){var b="";for(var c in a)b+=c+" : "+a[c]+"\n";return b},a.cpm.Module.prototype.run=function(b,c,d){var e=this;$.ajax({type:"POST",data:{cmd:"module run "+e.def.modulename,data:a.cpm.Module.confToYaml(b)},url:e.app.options.cpmbaseurl+"rest/cmd",dataType:"text",success:function(d,f,g){var h=d,i=e.app.view.createPanel(e.def.modulename+" (run "+h+")"),j=new a.cpm.Process(e.app,i.find(".frame-body"),{moduledef:e.def.module,runconf:b,runid:h});j.sync(),e.app.processmanager.fetchAll(),c.call(e.view)},error:function(){}})},a.cpm.Module.prototype.internalSyncToSource=function(){this.def.source=YAML.stringify(this.def.module)},a.cpm.Module.prototype.internalSyncToModel=function(){this.def.module=YAML.parse(this.def.source)}}(window.vw=window.vw||{}),function(a){a.cpm.ModuleManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.ModuleManagerView(this,c),this.init(),this.moduletree={},this.modules={},this.modulesobj=[]},a.cpm.ModuleManager.prototype.init=function(){var a=this;a.fetchAll()},a.cpm.ModuleManager.prototype.fetchAll=function(){var a=this;$.ajax({type:"POST",url:a.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"module ls --json"},dataType:"json",success:function(b,c,d){a.moduletree=b,a.modules={},a.parseModuleTree(b),a.view.refresh()}})},a.cpm.ModuleManager.prototype.parseModuleTree=function(a){if("object"==typeof a)if(a.constructor===Array)for(var b=a.length-1;b>=0;b--)this.parseModuleTree(a[b]);else a.hasOwnProperty("folder")&&a.folder?this.parseModuleTree(a.items):this.modules[a.modulename]=a},a.cpm.ModuleManager.prototype.fetch=function(a,b){var c=this;$.ajax({type:"POST",url:c.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"module info "+a+" --json"},dataType:"json",success:function(a,d,e){b.call(c,a)}})},a.cpm.ModuleManager.prototype.checkNameExist=function(a,b,c){var d=this,e=/^(_?[a-zA-Z][a-zA-Z0-9\-_]+(@[a-zA-Z0-9\-_]+)?)(#(?:\w|-)+)?$/,f=e.exec(a);return f?void $.ajax({type:"POST",url:d.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"module ls --name"},success:function(d,e,f){for(var g=d.split("\n"),h=0;h<g.length;h++)if(modname=g[h].trim(),modname==a)return void c.call();b.call()},error:function(){c.call()}}):void c.call()},a.cpm.ModuleManager.prototype.prepareCreateNewModule=function(){var b=this,c=new a.cpm.ui.Modal;$preconfig=$(a.cpm.ModuleManagerView.templatePreConfigAddNew),$preconfig.find(".create-module-preconfig-submit").click(function(){var a=$preconfig.find("input").val(),d="custom";b.checkNameExist(a,function(){c.close(),b.createNewModule(a,d)},function(){var a=c.getContainer();a.find(".error-message").remove(),a.prepend('<div class="error-message">Module name already exist or isn\'t allowed, please choose another name</div>')})}),c.open($preconfig)},a.cpm.ModuleManager.prototype.createNewModule=function(b,c){var d=this,e=d.app.view.createPanel(b),f={module:{name:b,desc:"please fill in a brief description",input:{},output:{},exec:[]},modulename:b,source:"name : "+b+"\n\ndesc : > \n  please fill in a brief description",sourcepath:d.app.cpmsettingsmanager.defaultModulesDir+"/custom/"+b+".module",creation:!0},g=new a.cpm.Module(d.app,e.find(".frame-body"),f);g.view.render()}}(window.vw=window.vw||{}),function(a){a.cpm.Process=function(b,c,d){this.app=b,this.init(d),this.view=new a.cpm.ProcessView(this,c)},a.cpm.Process.prototype.init=function(a){this.moduledef=a.moduledef,this.conf=a.runconf,this.runid=a.runid,this.info={},this.synced=!1},a.cpm.Process.prototype.sync=function(){var a=this;$.ajax({type:"POST",data:{cmd:"process get "+a.runid},url:a.app.options.cpmbaseurl+"rest/cmd",dataType:"json",success:function(b,c,d){a.info=b,a.synced=!0,a.view.refresh()},error:function(){alert("could not parse process info json (run id = "+a.runid+")")}})},a.cpm.Process.prototype["delete"]=function(){var a=this;$.ajax({type:"POST",data:{cmd:"process del "+a.runid},url:a.app.options.cpmbaseurl+"rest/cmd",success:function(b){if("ok"==b){var c=a.app.view.getPanelFromContent(a.view.$el);a.app.view.deletePanel(c),a.app.processmanager.remove(a.runid)}},error:function(){console.log("error when trying to delete process result "+a.runid)}})},a.cpm.Process.prototype.run=function(a,b,c){var d=this;console.log(a),b&&b.call(d.view)}}(window.vw=window.vw||{}),function(a){a.cpm.ProcessManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.ProcessManagerView(this,c),this.init(),this.runs={}},a.cpm.ProcessManager.prototype.init=function(){var a=this;a.fetchAll()},a.cpm.ProcessManager.prototype.showRun=function(b,c){var d=this,e=this.app.view.createPanel(b+" ( "+c+" )"),f=new a.cpm.Process(this.app,e.find(".frame-body"),{moduledef:d.app.modulesmanager.modules[b].module,runconf:{},runid:c});f.sync()},a.cpm.ProcessManager.prototype.remove=function(a){var b=this,c=!1;for(runmodulename in b.runs){for(var d=0;d<b.runs[runmodulename].length;d++)if(b.runs[runmodulename][d].runid==a){b.runs[runmodulename].splice(d,1),0==b.runs[runmodulename].length&&delete b.runs[runmodulename],c=!0;break}if(c)break}b.view.refresh()},a.cpm.ProcessManager.prototype.fetchAll=function(a,b){var c=this;$.ajax({type:"POST",url:c.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"process ls -a"},dataType:"text",success:function(a,b,d){c.runs={};var e=a.split("\n");for(var f in e){var g=e[f].trim();if(""!=g){var h=g.split(":"),i=h[0].trim();regex=/(.*?)\((.*?)\)/;var j=regex.exec(h.slice(1).join(":").trim());if(!j)continue;var k=j[1].trim(),l=j[2].trim();c.runs.hasOwnProperty(i)?c.runs[i].push({runid:k,datecreated:l}):c.runs[i]=[{runid:k,datecreated:l}]}}c.view.refresh()}})}}(window.vw=window.vw||{}),function(a){a.cpm.CLIView=function(a,b){this.$el=b,this.el=b[0],this.model=a,this.init(),this.panels=[]},a.cpm.CLIView.maxFrameHeight=500,a.cpm.CLIView.prototype.init=function(){var b=this;this.$fullscreencontainer=$(a.cpm.CLIView.fullscreentemplate),$("body").append(this.$fullscreencontainer),a.cpm.CLIView.maxFrameHeight=$(window).height()-178,$("#cmd-bar-container").perfectScrollbar({suppressScrollX:!0}),$("#active-content").css("height",window.innerHeight-94),$("#active-content").perfectScrollbar({suppressScrollX:!0}),$("#menu-content-body").css("height",window.innerHeight-80),$("#menu-content-body").perfectScrollbar({suppressScrollX:!0}),$(window).on("resize",function(){$("#menu-content-body").css("height",window.innerHeight-80),$("#menu-content-body").perfectScrollbar({suppressScrollX:!0}),$("#active-content").css("height",window.innerHeight-94),$("#active-content").perfectScrollbar({suppressScrollX:!0}),a.cpm.CLIView.maxFrameHeight=$(window).height()-178}),this.contentpanel=$("#active-content"),this.cmdbar=$("#cmdbar").cmd({prompt:"$",width:"100%",commands:function(a){b.model.request($("<div>"+a+"</div>").text())}}),$("#cmdbar").on("mousedown",function(c){2==c.which&&a.cpm.currentTextSelection&&(b.cmdbar.insert(a.cpm.currentTextSelection),b.toggleCLI(!0))}),jQuery("#app-title").click(function(){b.toggleCLI(!1),jQuery("#main").hasClass("menu-closed")&&(b.model.activemenu="default",b.model.setActiveMenu("default")),jQuery(".menu-open").switchClass("menu-open","menu-closed"),jQuery(".menu-closed").switchClass("menu-closed","menu-open")}),$(".main-menu-item").click(function(){b.model.activemenu==this.id?(jQuery(".menu-open").switchClass("menu-open","menu-closed"),jQuery(".menu-closed").switchClass("menu-closed","menu-open")):b.openMenu(this.id)}),jQuery("#menu").click(function(){b.toggleCLI(!1)}),jQuery("#menu-content").on("click",function(){b.toggleCLI(!1)}),jQuery("#active-content").on("click",function(){b.toggleCLI(!1)}),jQuery("#cmd-bar-container").on("click",function(){b.toggleCLI(!0)})},a.cpm.CLIView.prototype.closeMenu=function(){var a=this;a.model.activemenu="default",a.model.setActiveMenu("default"),jQuery(".menu-open").switchClass("menu-open","menu-closed")},a.cpm.CLIView.prototype.openMenu=function(a){var b=this;jQuery(".menu-closed").switchClass("menu-closed","menu-open"),b.model.setActiveMenu(a),b.model.activemenu=a},a.cpm.CLIView.prototype.toggleCLI=function(a){a?this.cmdbar.isenabled()||(this.cmdbar.enable(),this.cmdbar.focus()):this.cmdbar.isenabled()&&this.cmdbar.disable()},a.cpm.CLIView.prototype.stick=function(a){var b=this;this.contentpanel.find("#active-content-sticky").append(a);var c=a.find(".frame-tool-pin");c.removeClass("frame-tool-pin"),c.addClass("frame-tool-unpin"),c.unbind("click"),c.click(function(){b.unstick(a)}),b.contentpanel[0].scrollTop=0,b.contentpanel.perfectScrollbar("update")},a.cpm.CLIView.prototype.unstick=function(a){var b=this;this.contentpanel.find("#active-content-flow").append(a);var c=a.find(".frame-tool-unpin");c.removeClass("frame-tool-unpin"),c.addClass("frame-tool-pin"),c.unbind("click"),c.click(function(){b.stick(a)})},a.cpm.CLIView.prototype.getPanel=function(a,b){var c=this,d=-1;for(var e in c.panels)if(c.panels[e].find(".frame-title").html()==a){d=e;break}return-1!=d?c.panels[e]:b?void 0:c.createPanel(a)},a.cpm.CLIView.prototype.getPanelFromContent=function(a){return a.parents(".frame")},a.cpm.CLIView.prototype.quitFullscreen=function(a){var b=this;b.$fullscreencontainer.fadeOut();var c=b.$fullscreencontainer.find(".frame-title").children();0==c.length&&a.find(".frame-title").append(c);var d=b.$fullscreencontainer.find(".frame-body").children();0!=d.length&&(1==d.length&&d.prop("originalHeight")&&d.height(d.prop("originalHeight")),a.find(".frame-body").append(d))},a.cpm.CLIView.prototype.fullscreen=function(a){var b=this;b.$fullscreencontainer.fadeIn();var c=a.find(".frame-title").children();0==c.length&&(c=a.find(".frame-title").html());var d=a.find(".frame-body").children();0==d.length?d=a.find(".frame-body").html():1==d.length&&(d.prop("originalHeight",d.height()),d.height($(window).height()-100)),b.$fullscreencontainer.find(".frame-title").empty(),b.$fullscreencontainer.find(".frame-body").empty(),b.$fullscreencontainer.find(".frame-title").append(c),b.$fullscreencontainer.find(".frame-body").append(d),b.$fullscreencontainer.find(".frame-tool-quitfs").unbind("click"),b.$fullscreencontainer.find(".frame-tool-quitfs").on("click",function(){b.quitFullscreen(a)})},a.cpm.CLIView.prototype.show=function(a){var b=this,c=a.find(".frame-tool-show");c.removeClass("frame-tool-show"),c.addClass("frame-tool-hide"),c.unbind("click"),a.find(".frame-body").slideDown({complete:function(){c.on("click",function(){b.hide(a)})}})},a.cpm.CLIView.prototype.hide=function(a){var b=this,c=a.find(".frame-tool-hide");c.removeClass("frame-tool-hide"),c.addClass("frame-tool-show"),c.unbind("click"),a.find(".frame-body").slideUp({complete:function(){c.on("click",function(){b.show(a)})}})},a.cpm.CLIView.prototype.deletePanel=function(a){var b=this,c=b.panels.indexOf(a);-1!=c&&b.panels.splice(c,1),a.animate({opacity:.25,height:"toggle"},{complete:function(){a.remove()},duration:200})},a.cpm.CLIView.prototype.createPanel=function(b,c){var d=this,e=a.cpm.CLIView.frametemplate,f=$(e);return this.contentpanel.find("#active-content-flow").prepend(f),"undefined"!=b&&f.find(".frame-title").append(b),"undefined"!=c&&f.find(".frame-body").append(c),this.panels.push(f),f.find(".frame-title").mouseup(function(b){a.cpm.currentTextSelection=a.cpm.utils.getSelectionText()}),f.find(".frame-body").mouseup(function(b){a.cpm.currentTextSelection=a.cpm.utils.getSelectionText()}),f.find(".frame-tool-pin").click(function(){d.stick(f)}),f.find(".frame-tool-close").click(function(){d.deletePanel(f)}),f.find(".frame-tool-openfs").click(function(){d.fullscreen(f)}),f.find(".frame-tool-hide").click(function(){d.hide(f)}),d.contentpanel[0].scrollTop=0,d.contentpanel.perfectScrollbar("update"),f},a.cpm.CLIView.frametemplate='<div class="frame"><div class="frame-header"><div class="frame-title"></div><div class="frame-tools"><div class="frame-tool frame-tool-close"></div><div class="frame-tool frame-tool-pin"></div><div class="frame-tool frame-tool-openfs"></div><div class="frame-tool frame-tool-hide"></div></div></div><div class="frame-body"></div></div>',a.cpm.CLIView.fullscreentemplate='<div id="fullscreen-container"><div class="frame-header"><div class="frame-title"></div><div class="frame-tools"><div class="frame-tool frame-tool-quitfs"></div></div></div><div class="frame-body"></div></div>'}(window.vw=window.vw||{}),function(a){function b(a,b){var c=typeof a,d=typeof b;return a.hasOwnProperty("...")?-1:b.hasOwnProperty("...")?1:c!=d?"string"==c?-1:"string"==d?1:0:0}a.cpm.CorpusManagerView=function(a,b){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.model=a,this.init()},a.cpm.CorpusManagerView.prototype.init=function(){var a='<div class="treeview-fold treeview-unfolded" depth="0"><div class="treeview-node">Corpora</div><div id="corpora-corpora-container"></div></div><div class="treeview-fold treeview-unfolded" depth="0"><div class="treeview-node">Results</div><div id="corpora-results-container"></div></div>';this.$el.append(a),this.$el.find(".treeview-node").on("click",function(){var a=$(this).parent();if(a.hasClass("treeview-fold")){var b=a.children();a.hasClass("treeview-folded")?($(b[1]).slideDown(),a.removeClass("treeview-folded"),a.addClass("treeview-unfolded")):($(b[1]).slideUp(),a.removeClass("treeview-unfolded"),a.addClass("treeview-folded"))}})},a.cpm.CorpusManagerView.prototype.renderCorpora=function(a){var b=this,c=b.renderDirectory(a,b.model.app.cpmsettingsmanager.cpmsettings.corpus_dir,1);this.$el.find("#corpora-corpora-container").append(c)},a.cpm.CorpusManagerView.prototype.renderResults=function(a){var b=this,c=b.renderDirectory(a,b.model.app.cpmsettingsmanager.cpmsettings.result_dir,1);this.$el.find("#corpora-results-container").append(c)},a.cpm.CorpusManagerView.prototype.refresh=function(){var b=this,c=a.cpm.CorpusManagerView.renderSubTree(this.model.filetree.corpus,0,b.model.app.cpmsettingsmanager.cpmsettings.corpus_dir),d=a.cpm.CorpusManagerView.renderSubTree(this.model.filetree.results,0,b.model.app.cpmsettingsmanager.cpmsettings.result_dir);this.$el.html(c+d),this.$el.find(".treeview-node").on("click",function(){var a=$(this).parent();if(a.hasClass("treeview-fold")){var b=a.children();a.hasClass("treeview-folded")?($(b[1]).slideDown(),a.removeClass("treeview-folded"),a.addClass("treeview-unfolded")):($(b[1]).slideUp(),a.removeClass("treeview-unfolded"),a.addClass("treeview-folded"))}}),this.$el.find(".treeview-node").not(".treeview-more").draggable({appendTo:"body",opacity:.7,helper:"clone"}),this.$el.find(".treeview-leaf").not(".treeview-more").draggable({appendTo:"body",opacity:.7,helper:"clone"})},a.cpm.CorpusManagerView.renderSubTree=function(c,d,e){var f="";if("object"==typeof c)if(c.constructor===Array){c=c.sort(b);for(var g=c.length-1;g>=0;g--)f+=a.cpm.CorpusManagerView.renderSubTree(c[g],d,e)}else for(var g in c)if("..."==g)f+="file"==c[g]?'<div class="treeview-leaf treeview-more" style="margin-left:'+d+'px;" filepath="'+e+'">'+g+"</div>":'<div class="treeview-node treeview-more" style="margin-left:'+d+'px;" filepath="'+e+'">'+g+"</div>";else{var h="treeview-folded",i='style="display:none;"',j=g;0==d&&(h="treeview-unfolded",i="",j=""),f+='<div class="treeview-fold '+h+'"><div class="treeview-node" style="margin-left:'+d+'px;" filepath="'+e+j+'">'+g+"</div><div "+i+">"+a.cpm.CorpusManagerView.renderSubTree(c[g],d+14,e+j+"/")+"</div></div>"}else"string"==typeof c&&(f+='<div class="treeview-leaf" style="margin-left:'+d+'px;" filepath="'+e+c+'">'+c+"</div>");return f},a.cpm.CorpusManagerView.prototype.renderDirectory=function(a,b,c){for(var d=this,e=14*c,f="<div>",g=0;g<a.length;g++)if("object"==typeof a[g]){var h=_.first(_.keys(a[g]));f+="..."==h?'<div class="treeview-leaf treeview-more" style="margin-left:'+e+'px;" filepath="'+b+'" next="'+a[g][h]+'">'+h+"</div>":'<div class="treeview-fold treeview-folded" depth="'+c+'"><div class="treeview-node" style="margin-left:'+e+'px;" filepath="'+b+"/"+h+'">'+h+'</div><div style="display:none;"></div></div>'}else{var h=a[g];f+='<div class="treeview-leaf" style="margin-left:'+e+'px;" filepath="'+b+"/"+h+'">'+h+"</div>"}f+="</div>";var i=$(f);return i.find(".treeview-leaf").not(".treeview-more").click(function(){var a=$(this).attr("filepath");d.model.app.openFile(a)}),i.find(".treeview-more").click(function(){var a=this,b=$(this).attr("filepath"),c=$(this).parent(),e=$(this).attr("next"),f=0;$(a).addClass("treeview-leaf-waiting"),c.parent().hasClass("treeview-fold")&&(f=c.parent().attr("depth")),d.model.lsDir(b,e,function(b,c){var e=d.renderDirectory(b,c,parseInt(f)+1);$(a).removeClass("treeview-leaf-waiting"),$(a).replaceWith(e)})}),i.find(".treeview-node").click(function(){var a=this,b=$(this).attr("filepath"),c=$(this).parent(),e=0,f=0;$(a).addClass("treeview-node-waiting"),c.hasClass("treeview-fold")&&(f=c.attr("depth")),$(a).unbind("click"),d.model.lsDir(b,e,function(b,c){var e=d.renderDirectory(b,c,parseInt(f)+1),g=$(a).parent(".treeview-fold"),h=g.children();g.removeClass("treeview-folded"),g.addClass("treeview-unfolded"),$(a).removeClass("treeview-node-waiting"),$(h[1]).append(e),$(h[1]).slideDown(),$(a).on("click",function(){var a=$(this).parent();if(a.hasClass("treeview-fold")){var b=a.children();a.hasClass("treeview-folded")?($(b[1]).slideDown(),a.removeClass("treeview-folded"),a.addClass("treeview-unfolded")):($(b[1]).slideUp(),a.removeClass("treeview-unfolded"),a.addClass("treeview-folded"))}})})}),i.find(".treeview-node").not(".treeview-more").draggable({appendTo:"body",opacity:.7,helper:"clone"}),i.find(".treeview-leaf").not(".treeview-more").draggable({appendTo:"body",opacity:.7,helper:"clone"}),i.children()}}(window.vw=window.vw||{}),function(a){a.cpm.CPMSettingsManagerView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.CPMSettingsManagerView.prototype.init=function(){},a.cpm.CPMSettingsManagerView.prototype.render=function(){var a=this.model.cpmsettings,b="";b+='<div class="settings-field-title"> Corpus directory : </div><div class="settings-field-body">'+a.corpus_dir+"</div>",b+='<div class="settings-field-title"> Result directory : </div><div class="settings-field-body">'+a.result_dir+"</div>";for(var c='<div class="settings-field-title"> Modules directories :</div><div class="settings-field-body"><ul>',d=a.modules.length-1;d>=0;d--)c+="<li ",c+=a.modules[d].exist?">":'class="warning-field">',c+=a.modules[d].name+"</li>";c+="</ul></div>",b+=c,this.$el.append(b)}}(window.vw=window.vw||{}),function(a){a.cpm.HelpManagerView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.HelpManagerView.prototype.init=function(){var b=this;this.$el.append(a.cpm.HelpManagerView.template),this.$el.find("#help-main-wiki-page").on("click",function(){b.model.app.view.createPanel("Main wiki page",'<iframe width="100%" height="'+a.cpm.CLIView.maxFrameHeight+'px;" style="border:none;" src="'+b.model.app.options.cpmbaseurl+'/dokuwiki">')}),this.$el.find("#help-presa-slides").on("click",function(){var a=b.model.app.view.getPanel("Intro");a.find(".frame-body").html(b.model.slides)})},a.cpm.HelpManagerView.template='<div id="help-presa-slides" style="cursor:pointer;">Introduction slides</div><div id="help-main-wiki-page" style="cursor:pointer;">Main wiki</div>'}(window.vw=window.vw||{}),function(a){a.cpm.ModuleBoxView=draw2d.shape.layout.VerticalLayout.extend({NAME:"Module",init:function(a,b){this._super(),this.setUserData({def:a,name:b}),this.inputports=this.createPort("input",new draw2d.layout.locator.LeftLocator(this)),this.outputports=this.createPort("output",new draw2d.layout.locator.RightLocator(this)),console.log(a),this.setBackgroundColor("#f4f4f4"),this.setStroke(1),this.setColor("#e0e0e0"),this.setRadius(1);var c=this.createLabel(b).setStroke(0);this.label=c;var d=new draw2d.shape.basic.Rectangle;d.getHeight=function(){return 1},d.setMinWidth(90),d.setColor("#e0e0e0");var e=this.createLabel("???");this.activityLabel=e,e.setMinHeight(30),e.setStroke(0),e.setBackgroundColor(null),e.setFontColor("#a0a0a0"),this.add(c),this.add(d),this.add(e)},createLabel:function(a){var b=new draw2d.shape.basic.Label({text:a});return b.setStroke(1),b.setRadius(0),b.setBackgroundColor(null),b.setPadding(5),b.setColor(this.bgColor.darker(.2)),b.onDoubleClick=function(a){},b}})}(window.vw=window.vw||{}),function(a){function b(a,b){var c=typeof a,d=typeof b;return a.hasOwnProperty("folder")&&a.folder?1:b.hasOwnProperty("folder")&&b.folder?-1:c!=d?"string"==c?-1:"string"==d?1:0:0}a.cpm.ModuleManagerView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.ModuleManagerView.prototype.init=function(){var b=this;$mastercontainer=$(a.cpm.ModuleManagerView.template),b.$el.empty(),b.$el.append($mastercontainer),b.$el.find("#modulemanager-menu").append('<div id="modulemanager-add-new">Create a new module</div>'),b.$el.find("#modulemanager-add-new").click(function(){b.model.prepareCreateNewModule()})},a.cpm.ModuleManagerView.prototype.refresh=function(){var b=this;this.$el.find("#modulemanager-list").html(a.cpm.ModuleManagerView.renderSubTree(this.model.moduletree,0)),this.$el.find(".treeview-node").on("click",function(){var a=$(this).parent();if(a.hasClass("treeview-fold")){var b=a.children();a.hasClass("treeview-folded")?($(b[1]).slideDown(),a.removeClass("treeview-folded"),a.addClass("treeview-unfolded")):($(b[1]).slideUp(),a.removeClass("treeview-unfolded"),a.addClass("treeview-folded"))}}),this.$el.find(".treeview-leaf").on("click",function(){var c=$(this).html(),d=b.model.app.view.createPanel(c),e=new a.cpm.Module(b.model.app,d.find(".frame-body"),b.model.modules[c]);b.model.modulesobj.push(e),e.view.render()}),this.$el.find(".treeview-leaf").draggable({appendTo:"body",opacity:.7,helper:"clone"}),this.$el.find(".treeview-leaf").droppable()},a.cpm.ModuleManagerView.renderSubTree=function(c,d){var e="";if("object"==typeof c)if(c.constructor===Array){c=c.sort(b);for(var f=c.length-1;f>=0;f--)e+=a.cpm.ModuleManagerView.renderSubTree(c[f],d)}else if(c.hasOwnProperty("folder")&&c.folder)if(""!=c.foldername){var g="treeview-folded",h='style="display:none;"';g="treeview-unfolded",h="",e+='<div class="treeview-fold '+g+'"><div class="treeview-node treeview-module-folder" style="margin-left:'+d+'px;">'+c.foldername+"</div><div "+h+">"+a.cpm.ModuleManagerView.renderSubTree(c.items,d+14)+"</div></div>"}else e+=a.cpm.ModuleManagerView.renderSubTree(c.items,d);else e+=c.hasOwnProperty("module")?'<div class="treeview-leaf treeview-module-item draw2d_droppable" data-modname="'+c.module.name+'" style="margin-left:'+d+'px;">'+c.module.name+"</div>":'<div class="treeview-leaf treeview-module-item" style="margin-left:'+d+'px; color:red;">'+c.modulename+"</div>";
return e},a.cpm.ModuleManagerView.template='<div><div id="modulemanager-menu"></div><div id="modulemanager-list"></div></div>',a.cpm.ModuleManagerView.templatePreConfigAddNew='<div><div style="padding:12px;"><div>Choose a name for your new module (allowed form : [a-zA-Z][a-zA-Z0-9-_]+(@[a-zA-Z0-9-_]+)? ): <input type="text"></div><button class="create-module-preconfig-submit" type="button">Ok</button><div style="margin-top:24px; font-size:0.75em;">For more information about how to create modules refer to help pages.</div></div></div>'}(window.vw=window.vw||{}),function(a){a.cpm.ModuleView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.ModuleView.prototype.init=function(){var b=this;this.$el.append(a.cpm.ModuleView.template),b.model.def.hasOwnProperty("module")?b.renderGraphical():b.renderSource(),b.setActiveMenu(".module-view-graphic"),this.$el.find(".module-view-source").on("click",function(){b.$el.find(".module-content-view").empty(),b.renderSource(),b.setActiveMenu(".module-view-source")}),this.$el.find(".module-view-graphic").on("click",function(){b.showGraphical(),b.setActiveMenu(".module-view-graphic")}),this.$el.find(".module-save").on("click",function(){b.model.sync(function(){},function(){})}),this.$el.find(".module-run").on("click",function(){b.$el.find(".module-content-view").empty(),b.renderRunConfForm(),b.setActiveMenu(".module-run")})},a.cpm.ModuleView.prototype.setActiveMenu=function(a){this.$el.find(".module-header-item").removeClass("active"),this.$el.find(a).addClass("active")},a.cpm.ModuleView.prototype.render=function(){},a.cpm.ModuleView.prototype.renderSource=function(){var a=this,b=a.model.def.source;this.$el.find(".module-content-view").append('<div id="source-'+this.id+'" class="module-source-editor"></div>'),this.$el.find("#source-"+this.id).append(b),this.editor=ace.edit("source-"+this.id);var c=ace.require("ace/mode/yaml").Mode;0==a.model.def.modulename.indexOf("_")&&this.setReadOnly(!0),this.editor.getSession().setTabSize(2),this.editor.getSession().setUseSoftTabs(!0),this.editor.session.setMode(new c)},a.cpm.ModuleView.prototype.renderRunConfForm=function(){var a=this;$form=$("<div></div>");var b=a.model.def.module.input;for(var c in b)$form.append('<div class="module-run-conf-form-field"><span style="font-weight:bold">'+c+'</span><span style="font-style:italic;"> ('+b[c].type+')</span><input type="text" value="" name="'+c+'"></div>');$form.append('<center><button class="submit" type="button">Run</button></center>'),this.$el.find(".module-content-view").append($form),$form.find("input").droppable({drop:function(a,b){$(this).val(b.draggable.attr("filepath"))}}),$form.find(".submit").on("click",function(){var c={};for(var d in b)c[d]=$form.find('input[name="'+d+'"]').val();a.model.run(c,function(){a.showGraphical(),a.setActiveMenu(".module-view-graphic")})})},a.cpm.ModuleView.prototype.showGraphical=function(){var a=this;a.$el.find(".module-content-view").empty(),a.model.def.hasOwnProperty("module")?a.renderGraphical():a.$el.find(".module-content-view").append("Unable to display graphical view of this module, definition contains error, please correct source file before")},a.cpm.ModuleView.prototype.renderGraphical=function(){var b=this;if(this.$el.find(".module-content-view").append(a.cpm.ModuleView.templateGraphical),this.$el.find(".canvas-view").attr("id",this.id),this.$el.find(".module-view-infos-panel").html(b.model.def.module.desc),0!=b.model.def.modulename.indexOf("_")){b.canvas&&b.canvas.destroy(),b.canvas=new draw2d.Canvas(b.id),b.canvas.onDrop=function(c,d,e,f,g){console.log();var h=b.model.app.modulesmanager.modules[c.data("modname")],i=new a.cpm.ModuleBoxView(h.module,h.module.name);b.canvas.add(i,d,e)},b.canvas.on("select",function(a,b){console.log(a),console.log(b)});for(var c=0;c<b.model.def.module.exec.length;c++){var d=_.first(_.keys(b.model.def.module.exec[c]));regex=/(_?[a-zA-Z][a-zA-Z0-9\-_]+(@[a-zA-Z0-9\-_]+)?)(#(?:\w|-)+)?/;var e=regex.exec(d);e||alert("error when fetching execution modules pipeline ! ");var f=(b.model.app.modulesmanager.modules[e[1]],new a.cpm.ModuleBoxView(b.model.def.module.exec[c],d));b.canvas.add(f,150*c+50,50)}}},a.cpm.ModuleView.templateGraphical='<div><div class="canvas-view"></div><div class="module-view-infos-panel"></div></div>',a.cpm.ModuleView.template='<div class="module-header"><span class="module-view-source module-header-item" style="float:left; margin-left:8px;">source</span><span class="module-view-graphic module-header-item" style="float:left; margin-left:20px;">view</span><span class="module-run module-header-item" style="float:right; margin-right:8px;">run</span><span class="module-save module-header-item" style="float:right; margin-right:20px;">save</span></div><div class="module-content-view"></div>',a.cpm.ModuleView.templateGraphic='<div class="module-graphical-view"><div ></div>'}(window.vw=window.vw||{}),function(a){a.cpm.ProcessManagerView=function(a,b){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.model=a,this.init()},a.cpm.ProcessManagerView.prototype.init=function(){},a.cpm.ProcessManagerView.prototype.refresh=function(){var a=this,b="";for(var c in a.model.runs){b+='<div><div class="settings-field-title" style="cursor:pointer;">'+c+'</div><div class="settings-field-body"><ul class="run-list" style="font-size:12px;">';for(var d in a.model.runs[c])b+='<li runid="'+a.model.runs[c][d].runid+'">'+a.model.runs[c][d].datecreated+"</li>";b+="</ul></div></div>"}a.$el.empty(),a.$el.append(b),a.$el.find(".settings-field-title").on("click",function(){$(this).parent().find(".settings-field-body").toggle()}),a.$el.find(".settings-field-body li").on("click",function(){a.model.showRun($(this).parents(".settings-field-body").prev().html().trim(),$(this).attr("runid"))})}}(window.vw=window.vw||{}),function(a){a.cpm.ProcessView=function(a,b){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.model=a,this.init()},a.cpm.ProcessView.prototype.init=function(){this.$el.append(a.cpm.ProcessView.template)},a.cpm.ProcessView.prototype.refresh=function(){var b=this;if(b.model.synced){b.$el.find(".run-status .info-box-content").html("<div>"+b.model.info.status+'</div><button class="processresult-refresh" type="button">refresh</button><button class="processresult-delete" type="button">delete</button>'),b.$el.find(".run-status .info-box-content .processresult-refresh").on("click",function(){b.model.sync()}),b.$el.find(".run-status .info-box-content .processresult-delete").on("click",function(){b.model["delete"]()});var c="<ul>";for(var d in b.model.info.runconf)c+='<li><span style="font-weight:bold;">'+d+" : </span><span>"+a.cpm.ProcessView.printVar(b.model.info.runconf[d])+"</span></li>";c+="</ul>",b.$el.find(".run-config .info-box-content").html(c);var e="<ul>";for(var d in b.model.info.env)b.model.info.runconf.hasOwnProperty(d)||(e+='<li><span style="font-weight:bold;">'+d+" : </span><span>"+a.cpm.ProcessView.printVar(b.model.info.env[d])+"</span></li>");for(var d in b.model.info.parentEnv)b.model.info.runconf.hasOwnProperty(d)||(e+='<li><span style="font-weight:bold;">'+d+" : </span><span>"+a.cpm.ProcessView.printVar(b.model.info.parentEnv[d])+"</span></li>");e+="</ul>",b.$el.find(".run-results .info-box-content").html(e),b.$el.find(".file-var").click(function(){b.model.app.openFile($(this).html().trim())})}},a.cpm.ProcessView.printVar=function(a){if("FILE"==a.type)return'<span class="file-var">'+a.value+"</span>";if("FILE*"==a.type){for(var b="<ul>",c=0;c<a.value.length;c++)b+='<li class="file-var">'+a.value[c]+"</li>";return b+="</ul>"}return"string"==typeof a.value&&"html"==a.format?a.value:JSON.stringify(a.value).replace("/\n/","<br>").replace("/s/","&nbsp;").replace('/\\"/','"')},a.cpm.ProcessView.template='<div class="run-status info-box"><div class="info-box-title">Status</div> <div class="info-box-content"></div></div><div class="run-config info-box"><div class="info-box-title">Config</div><div class="info-box-content"></div></div><div class="run-results info-box"><div class="info-box-title">Results</div> <div class="info-box-content"></div></div>'}(window.vw=window.vw||{});