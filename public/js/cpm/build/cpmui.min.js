/*! cpmui 14-06-2016 */
!function(a){a.cpm={}}(window.vw=window.vw||{}),function(a){a.cpm.Command=function(a,b){this.command=a,this.data=b},a.cpm.Command.prototype.execute=function(b){var c=this;a.cpm.utils.waitTill(b,"isInitiated",function(){if("p"==c.command)b.processmanager.showRun(c.data.name,c.data.runid);else if("m"==c.command)b.modulesmanager.showModule(c.data);else if("f"==c.command)b.openFile(c.data);else if("i"==c.command){var a=c.data.split("	");b.openIFrame(a[1],a[0])}else"s"==c.command?"log"==c.data?b.logger.view():"help"==c.data&&b.helpmanager.displayCLIHelp():"l"==c.command?b.servicemanager.showService(c.data)||b.logger.warn("unknown panel system command : "+c.data):"c"==c.command?b.request(c.data):b.logger.warn("unknown panel command : "+c.command+"("+c.data+")")},1e3)}}(window.vw=window.vw||{}),function(a){a.cpm.CLI=function(b,c){this.options=c,this.view=new a.cpm.CLIView(this,b),this.init(),a.cpm.INSTANCE=this},a.cpm.CLI.prototype.init=function(){var b=this;a.cpm.SingletonCLI=this,this.logger=new a.cpm.Logger(this,{}),this.logger.info("Starting AppFM web ui"),this.testmodule="treetagger_fr",store.enabled||alert('Local storage is not supported by your browser. Please disable "Private Mode", or upgrade to a modern browser. Your session won\'t be saved across page reloads'),this.activemenu="",this.menus={"default":{title:"Application Frame Mngr",body:$("<div></div>")},"corpus-menu":{title:"Corpora",body:$("<div></div>")},"module-menu":{title:"Modules",body:$("<div></div>")},"process-menu":{title:"Process",body:$("<div></div>")},"service-menu":{title:"Services",body:$("<div></div>")},"settings-menu":{title:"Settings",body:$("<div></div>")},"help-menu":{title:"Help",body:$("<div></div>")}},b.wssocketactive=!1,this.reload(),this.checkstatus(),this.helpmanager=new a.cpm.HelpManager(this,this.menus["help-menu"].body)},a.cpm.CLI.prototype.checkstatus=function(){var a=this;this.longpolling,clearInterval(this.longpolling),this.longpolling=setInterval(function(){$.ajax({type:"POST",data:{cmd:"status"},url:a.options.cpmbaseurl+"rest/cmd",success:function(b,c,d){"timeout"==b?(a.logger.error("Couldn't connect to server : timeout"),a.view.setStatusButton("offline")):a.wssocketactive?(a.view.setStatusButton("online"),clearInterval(a.longpolling),a.longpolling=void 0):a.view.setStatusButton("limited")},error:function(b,c,d){a.logger.error(d),a.view.setStatusButton("offline")},timeout:2e4})},6e4)},a.cpm.CLI.prototype.initWS=function(){var b=this;if(!b.wssocketactive)try{this.wssocket=new WebSocket("ws://"+b.options.cpmwshost),this.wssocket.onopen=function(a){b.logger.info("opening websocket connection"),b.wssocketactive=!0,b.view.setStatusButton("online")},this.wssocket.onclose=function(a){b.logger.info("websocket connection ended with code "+a.code+" ( "+a.reason+" )"),b.wssocketactive=!1,b.checkstatus(),console.log(arguments)},this.wssocket.onmessage=function(c){var d=JSON.parse(c.data);"kernel-started"==d.type||"kernel-stopped"==d.type||("process-ended"==d.type?-1!=_.indexOf(b.processmanager.startedprocess,d.target)&&(a.cpm.utils.showNotif("Process ended !","The run ("+d.target+") of module "+d.more+" has ended !",function(){b.processmanager.showRun(d.more,d.target)},b.options.cpmbaseurl+"public/img/system/process.png"),b.processmanager.showRun(d.more,d.target),b.corpusmanager.refreshResults()):"process-started"==d.type?b.processmanager.fetchAll():"process-deleted"==d.type?(b.processmanager.fetchAll(),b.corpusmanager.refreshResults()):"process-update"==d.type?b.logger.info(d.target+"\n"+d.more):"module-created"==d.type?b.modulesmanager.fetchAll():"module-updated"==d.type?b.modulesmanager.fetchAll():"service-started"==d.type?b.servicemanager.fetchAll():"service-stopped"==d.type?b.servicemanager.fetchAll():(console.log(c),b.logger.info(d.type+" "+d.target+" "+d.more)))},this.wssocket.onerror=function(a){console.log(arguments),b.checkstatus()}}catch(c){return void b.logger.warn(c)}},a.cpm.CLI.prototype.reload=function(){var b=this;this.cpmsettingsmanager=new a.cpm.CPMSettingsManager(this,this.menus["settings-menu"].body,{init:function(){var a=store.get("connectionInfo");a&&(b.options.cpmwshost!=a.CPM_WS_HOST||b.options.cpmhost!=a.CPM_HOST||b.options.cpmport!=a.CPM_PORT)&&b.cpmsettingsmanager.updateConnection(a.CPM_HOST,a.CPM_PORT,a.CPM_WS_HOST),b.logger.info("Received appfm server settings"),b.initmodules()}})},a.cpm.CLI.prototype.isInitiated=function(){return this.cpmsettingsmanager.initiated&&this.modulesmanager.initiated&&this.processmanager.initiated&&this.corpusmanager.initiated},a.cpm.CLI.prototype.initmodules=function(){var b=this;this.view.setStatusButton("online"),this.modulesmanager=new a.cpm.ModuleManager(this,this.menus["module-menu"].body),this.corpusmanager=new a.cpm.CorpusManager(this,this.menus["corpus-menu"].body),this.servicemanager=new a.cpm.ServiceManager(this,this.menus["service-menu"].body),this.processmanager=new a.cpm.ProcessManager(this,this.menus["process-menu"].body),this.initWS();var c=store.get("firstrun");if(c){if(0==this.view.panels.length){var d=store.get(b.options.cpmhost+"-panels");if(d&&d.length>0){store.set(b.options.cpmhost+"-panels",[]);for(var e=d.length-1;e>=0;e--)a.cpm.Panel.deserialize(this,d[e]),this.logger.info("Loading panel : "+d[e].cmd.command+" "+d[e].cmd.data)}else{this.openIFrame(this.options.cpmbaseurl+"/introslides","Intro")}}}else{this.openIFrame(this.options.cpmbaseurl+"/introslides","Intro");b.demo(),store.set("firstrun","done")}},a.cpm.CLI.prototype.setActiveMenu=function(a){this.view.$el.find("#menu-content-title").empty(),this.view.$el.find("#menu-content-body").children().detach();var b=this.menus[a];this.view.$el.find("#menu-content-title").append(b.title),this.view.$el.find("#menu-content-body").append(b.body)},a.cpm.CLI.prototype.cpmRawCall=function(a,b){var c=this;$.ajax({type:"POST",data:{cmd:a},url:c.options.cpmbaseurl+"rest/cmd",success:function(a,d,e){b.call(c,a)},error:function(){}})},a.cpm.CLI.prototype.cpmCall=function(a,b){var c=this;$.ajax({type:"POST",data:{cmd:a+" --json"},url:c.options.cpmbaseurl+"rest/cmd",dataType:"json",success:function(a,d,e){b.call(c,a)},error:function(a,b,d){c.logger.error(d)}})},a.cpm.CLI.prototype.request=function(b){var c=this;if(b=b.trim(),"help"==b)return void c.helpmanager.displayCLIHelp();if("brat"==b)return void this.openIFrame("http://"+c.options.cpmhost+":8001/index.xhtml","brat");if("depgraph"==b)return void this.openIFrame("http://"+c.options.cpmhost+"/depgraph","depgraph");if(b.startsWith("file")){var d=b.split(" ");return void c.openFile(d[1])}return"cadvisor"==b?void this.openIFrame("http://"+c.options.cpmhost+":8082/","cadvisor"):void c.cpmRawCall(b,function(d){d=jQuery("<div />").text(d).html(),d='<code><pre class="pre-wrapped">'+d+"</pre></code>";var e=c.view.createPanel(b,d,"cmd-"+b,new a.cpm.Command("c",b)),f=$('<div class="frame-tool-refresh"></div>');e.addToolButton(f),f.on("click",function(){c.cpmRawCall(b,function(a){a=jQuery("<div />").text(a).html(),a='<code><pre class="pre-wrapped">'+a+"</pre></code>";var b=e.$el.find(".frame-body");b.empty(),b.append(a)})})})},a.cpm.CLI.prototype.openIFrame=function(b,c){var d=this,e=b;c&&(e=c);var f=d.view.createPanel('<a href="'+b+'" target="_blank">'+e+"</a>","","iframe-"+b,new a.cpm.Command("i",e+"	"+b)),g=$('<div class="frame-tool-refresh"></div>');return f.addToolButton(g),g.on("click",function(){var a=f.$el.find("iframe");a[0].src=a[0].src}),f.$el.find(".frame-body").append('<iframe style="border-style:none;border:0;margin:0;padding:0;" width="100%" height="600px" src="'+b+'"></iframe>'),f},a.cpm.CLI.prototype.openFile=function(b){var c=this;c.cpmRawCall("fs get "+b,function(d){d=jQuery("<div />").text(d).html(),d='<code><pre class="pre-wrapped">'+d+"</pre></code>";var e=c.view.createPanel(b,d,"fs-"+b,new a.cpm.Command("f",b)),f=$('<div class="frame-tool-download"></div>');e.addToolButton(f),f.on("click",function(){a.cpm.utils.windowOpenPost({file:b},c.options.cpmbaseurl+"file")})})},a.cpm.CLI.prototype.cpmSettings=function(){},a.cpm.CLI.prototype.demo=function(){var a=this,b=introJs();b.setOptions({steps:[{intro:"<h1>Welcome to AppFM</h1>the Application Frame Manager for NLP!<br>This short tutorial will present you the basic interface."},{element:document.querySelector("#cmd-bar-container"),intro:"This is the command bar. It sends direct raw command to the server.",position:"bottom"},{element:document.querySelectorAll(".frame")[0],intro:"Results of most commands are displayed in windows frame within content flow.",position:"bottom"},{element:document.querySelector("#app-title"),intro:"This button shows the currently opened frames",position:"right"},{element:document.querySelector("#corpus-menu"),intro:"There is 3 main menus. This first one show a list of all corpus handled by AppFM.",position:"right"},{element:document.querySelector("#module-menu"),intro:"This one list the modules available that can be executed over the data available in the previous menu.",position:"right"},{element:document.querySelector("#process-menu"),intro:"This last one shows the list of past modules executions.",position:"right"},{element:document.querySelector("#settings-menu"),intro:"Global settings can be reviewed here.",position:"right"},{element:document.querySelector("#log-button"),intro:"Clicking here will show you some logged informations.<br>The status button next to it should be green or yellow (in case optional websockets isn't supported by your browser or port is blocked)",position:"top"},{element:document.querySelector("#help-menu"),intro:"...and if you need more help, this is where you can find further documentation.",position:"right"}]}),b.onchange(function(b){"app-title"==b.id?a.view.openMenu("default"):"corpus-menu"==b.id?a.view.openMenu("corpus-menu"):"module-menu"==b.id?a.view.openMenu("module-menu"):"process-menu"==b.id?a.view.openMenu("process-menu"):"settings-menu"==b.id?a.view.openMenu("settings-menu"):"help-menu"==b.id&&a.view.openMenu("help-menu")}),b.onexit(function(){a.view.closeMenu()}),b.oncomplete(function(){a.view.closeMenu()}),b.start()},a.cpm.CLI.prototype.demoModule=function(){var a=this,b=introJs(),c=a.testmodule;if(!a.modulesmanager.modules.testmodule)for(modulename in a.modulesmanager.modules)if("_CMD"!=modulename&&"_MAP"!=modulename){c=modulename;break}a.modulesmanager.showModule(c);var d=a.modulesmanager.getModule(c);b.setOptions({steps:[{intro:"<h1>Modules</h1>This short tutorial will present you how the basic actions availables with modules."},{element:document.querySelector("#module-menu"),intro:"Modules available are list here.<br>For the tutorial purpose, We'll open one for you.",position:"bottom"},{element:document.querySelectorAll(".frame")[0],intro:"Here is the module view",position:"bottom"},{element:document.querySelectorAll(".frame")[0].querySelector(".module-header"),intro:"From this menu you can view the source, save modification, and run it",position:"bottom"},{element:document.querySelectorAll(".frame")[0].querySelector(".module-run"),intro:"Let's go to the run section",position:"bottom"},{element:document.querySelector("#corpus-menu"),intro:"You can then drag and drop files from corpus into the proper input fields.",position:"right"},{element:document.querySelector("#corpus-menu"),intro:"You can then drag and drop files from corpus into the proper input fields.",position:"right"},{element:document.querySelector("#process-menu"),intro:"This last one shows the list of past modules executions.",position:"right"}]}),b.onchange(function(b){"corpus-menu"==b.id?a.view.openMenu("corpus-menu"):"module-menu"==b.id?a.view.openMenu("module-menu"):b.classList.contains("module-run")?d.run():"process-menu"==b.id?a.view.openMenu("process-menu"):"settings-menu"==b.id?a.view.openMenu("settings-menu"):"help-menu"==b.id&&a.view.openMenu("help-menu")}),b.onexit(function(){a.view.closeMenu()}),b.oncomplete(function(){a.view.closeMenu()}),b.start()}}(window.vw=window.vw||{}),function(a){a.cpm.ui={},a.cpm.ui.Modal=function(){var b=this;this.$el=$(a.cpm.ui.Modal.template),this.$el.find(".cpm-modal-close").click(function(){b.close()}),this.$el.find(".cpm-modal-content").perfectScrollbar({suppressScrollY:!0}),this.$el.hide()},a.cpm.ui.Modal.prototype.open=function(b){return a.cpm.ui.Modal.alreadyExist?void console.log("error : a modal is already open! this is a quick handmade framework that doesn't handle multiple opened modals.."):(a.cpm.ui.Modal.alreadyExist=!0,$modalbg=$('<div id="cpm-modal-bg"></div>'),$("body").append($modalbg),$modalbg.perfectScrollbar(),this.$el.find(".cpm-modal-content").append(b),$modalbg.append(this.$el),void this.$el.slideDown())},a.cpm.ui.Modal.prototype.getContainer=function(){return this.$el.find(".cpm-modal-content")},a.cpm.ui.Modal.prototype.close=function(){this.$el.slideUp({complete:function(){$("body").find("#cpm-modal-bg").remove(),a.cpm.ui.Modal.alreadyExist=!1}})},a.cpm.ui.Modal.alreadyExist=!1,a.cpm.ui.Modal.template='<div class="cpm-modal"><div class="cpm-modal-header"><div class="cpm-modal-close"></div></div><div class="cpm-modal-content"></div></div>',a.cpm.ui.WrapDiv=function(b,c,d,e){var f=this;this.$el=$(a.cpm.ui.WrapDiv.template),this.$el.find(".cpm-wrap-div-switch").click(function(){f.wrapToggle()});var g=f.$el.find(".cpm-wrap-div-content");d&&g.css("min-height",d),e&&g.css("max-height",e),c&&f.$el.find(".cpm-wrap-div-header").prepend(c),g.append(b)},a.cpm.ui.WrapDiv.prototype.wrapToggle=function(){},a.cpm.ui.WrapDiv.template='<div class="cpm-wrap-div"><div class="cpm-wrap-div-header"><div class="cpm-wrap-div-switch"></div></div><div class="cpm-wrap-div-content"></div></div>',a.cpm.ui.AjaxButton={start:function(a){a&&a.addClass("ajax-submitted")},stop:function(a){a&&a.removeClass("ajax-submitted")}}}(window.vw=window.vw||{}),function(a){a.cpm.utils={},a.cpm.utils.guids=[],a.cpm.utils.guid=function(){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}for(var c=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();-1!=a.cpm.utils.guids.indexOf(c);)c=b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b();return a.cpm.utils.guids.push(c),c},a.cpm.utils.showNotif=function(b,c,d,e){if(!Notification)return void(a.cpm.SingletonCLI&&a.cpm.SingletonCLI.logger.warn("Desktop notifications not available in your browser. Try a more recent browser."));if("granted"==Notification.permission){var f=new Notification(b,{icon:e,body:c});f.onclick=d}},a.cpm.utils.windowOpenPost=function(a,b){var c='<form id="depgraphlibWindowOpenPostForm" method="post" action="'+b+'" target="_blank"></form>',d=jQuery("#depgraphlibWindowOpenPostForm");d.length||(d=jQuery(c),jQuery("body").append(d)),d.html("");for(param in a){var e=null;e="string"==typeof a[param]?a[param]:JSON.stringify(a[param]),d.append('<input type="hidden" name="'+param+'" value="">'),d[0][param].value=e}document.getElementById("depgraphlibWindowOpenPostForm").submit()},a.cpm.utils.waitTill=function(a,b,c,d){var e=setInterval(function(){var d=!1;d=_.isFunction(a[b])?a[b].call(a):a[b],d&&(clearInterval(e),c.call())},d)},a.cpm.utils.getSelectionText=function(){var a="";return window.getSelection?a=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(a=document.selection.createRange().text),a},a.cpm.utils.getParentDir=function(a){var b=a.lastIndexOf("/");return-1!=b?a.substring(0,b):a},a.cpm.utils.extractVars=function(b,c){var d=[];if("object"==typeof b)if(b.constructor===Array)for(var e=0;e<b.length;e++)d=d.concat(a.cpm.utils.extractVars(b[e],c));else for(var e in b)d=d.concat(a.cpm.utils.extractVars(b[e],c));else for(var f,g=b.replace("\\$","__DOLLAR_ESCAPED__"),h=/\$(?:(?:\{(([a-zA-Z_\-\.@]+)(:.+)?)\})|([a-zA-Z_\-]+))/g;f=h.exec(g);){var i={ref:c,raw:b};f[1]?(i.name=f[2],f[3]&&(i.attr=f[3].substring(1))):i.name=f[4],d.push(i)}return d}}(window.vw=window.vw||{}),function(a){a.cpm.CorpusManager=function(b,c,d){this.loaded=0,this.initiated=!1,this.options=d,this.app=b,this.view=new a.cpm.CorpusManagerView(this,c),this.filetree={},this.init()},a.cpm.CorpusManager.prototype.init=function(){var a=this;a.fetch()},a.cpm.CorpusManager.prototype.fetch=function(){var a=this;a.lsDir(a.app.cpmsettingsmanager.cpmsettings.corpus_dir,0,function(b){a.view.renderCorpora(b)}),a.lsDir(a.app.cpmsettingsmanager.cpmsettings.result_dir,0,function(b){a.view.renderResults(b)})},a.cpm.CorpusManager.prototype.refreshResults=function(){var a=this;a.lsDir(a.app.cpmsettingsmanager.cpmsettings.result_dir,0,function(b){a.view.renderResults(b)})},a.cpm.CorpusManager.prototype.lsDir=function(a,b,c){var d=this;$.ajax({type:"POST",url:d.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"corpus lsdir "+a+" "+b},dataType:"json",success:function(b,e,f){c.call(d,b,a),d.loaded+=1,2==d.loaded&&(d.initiated=!0)}})}}(window.vw=window.vw||{}),function(a){a.cpm.CPMSettingsManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.CPMSettingsManagerView(this,c),this.cpmsettings={corpus_dir:"not connected",modules:[],result_dir:"not connected"},this.initiated=!1,this.init()},a.cpm.CPMSettingsManager.prototype.init=function(a){var b=this;b.view.render(),b.fetch()},a.cpm.CPMSettingsManager.prototype.fetch=function(a){var b=this;this.app.cpmCall("settings",function(a){b.initiated=!0,b.cpmsettings=a;for(var c=0;c<a.modules.length;c++)if(a.modules[c].exist){b.defaultModulesDir=a.modules[c].name;break}b.view.render(),b.options.init&&b.options.init.call(b.app)})},a.cpm.CPMSettingsManager.prototype.updateConnection=function(b,c,d,e){console.log(b);var f=this;a.cpm.ui.AjaxButton.start(e),$.ajax({type:"POST",data:{CPM_HOST:b,CPM_PORT:c,CPM_WS_HOST:d},dataType:"json",url:f.app.options.cpmbaseurl+"updateConnectionInfo",success:function(f,g,h){a.cpm.ui.AjaxButton.stop(e),f.error?alert("wrong connection information. nothing changed!"):f.success?(store.set("connectionInfo",{CPM_HOST:b,CPM_PORT:c,CPM_WS_HOST:d}),window.location.reload()):(console.log(f),alert("something went wrong. nothing changed!"))},error:function(){a.cpm.ui.AjaxButton.stop(e),alert("wrong connection information. nothing changed!")}})}}(window.vw=window.vw||{}),function(a){a.cpm.HelpManager=function(b,c,d){this.options=d,this.app=b,this.view=new a.cpm.HelpManagerView(this,c),this.init()},a.cpm.HelpManager.prototype.init=function(){},a.cpm.HelpManager.prototype.displayCLIHelp=function(){var b="todo.. :/";this.app.view.createPanel("help",b,"system-help",new a.cpm.Command("s","help"))}}(window.vw=window.vw||{}),function(a){a.cpm.Logger=function(a,b){this.options=b,this.app=a,this.logs=[],this.refreshlog=!1},a.cpm.Logger.prototype.appendLog=function(a,b){var c=new Date,d=c.toUTCString();this.logs.push({entry:a,type:b,date:d}),this.refreshlog=!0,this.refresh()},a.cpm.Logger.prototype.info=function(a){this.appendLog(a,"info")},a.cpm.Logger.prototype.debug=function(a){this.appendLog(a,"debug")},a.cpm.Logger.prototype.warn=function(a){this.appendLog(a,"warn")},a.cpm.Logger.prototype.error=function(a){this.appendLog(a,"error")},a.cpm.Logger.prototype.refresh=function(){var a=this,b=a.app.view.getPanel("AppFM log",!0);b&&(b.$el.find(".frame-body").empty(),b.$el.find(".frame-body").append(a.render()),this.refreshlog=!1)},a.cpm.Logger.prototype.view=function(){var b=this,c=b.app.view.getPanel("AppFM log",!0);c?b.refreshlog&&(c.$el.find(".frame-body").empty(),c.$el.find(".frame-body").append(b.render())):c=b.app.view.createPanel("AppFM log",b.render(),"system-log",new a.cpm.Command("s","log")),this.refreshlog=!1,c.focus()},a.cpm.Logger.prototype.render=function(){data="";for(var a=this.logs.length-1;a>=0;a--){var b=this.logs[a];data+=b.type+" - "+b.date+" : "+b.entry+"\n"}return'<code><pre class="pre-wrapped">'+data+"</pre></code>"}}(window.vw=window.vw||{}),function(a){a.cpm.Module=function(b,c,d){this.def=d,this.app=b,this.view=new a.cpm.ModuleView(this,c),this.synced=!1},a.cpm.Module.prototype.init=function(){},a.cpm.Module.prototype.fetch=function(){},a.cpm.Module.prototype.sync=function(b,c){var d=this;d.def.source=d.view.editor.getValue();var e="update "+d.def.modulename;d.def.creation&&(e="create "+d.def.modulename+" "+a.cpm.utils.getParentDir(d.def.sourcepath)),$.ajax({type:"POST",data:{cmd:"module "+e,data:d.def.source},url:d.app.options.cpmbaseurl+"rest/cmd",dataType:"json",success:function(a,e,f){a.success?((d.def.creation||!d.def.module)&&(d.app.modulesmanager.fetchAll(),delete d.def.creation),delete d.def.error,d.internalSyncToModel(),b.call()):(d.def.error=a.error,alert(a.error),c.call())},error:function(){c.call()}})},a.cpm.Module.confToYaml=function(a){var b="";for(var c in a)b+=c+" : "+a[c]+"\n";return b},a.cpm.Module.prototype.run=function(b,c,d){var e=this;$.ajax({type:"POST",data:{cmd:"module run "+e.def.modulename,data:a.cpm.Module.confToYaml(b)},url:e.app.options.cpmbaseurl+"rest/cmd",dataType:"text",success:function(a,b,d){var f=a;e.app.processmanager.startedprocess.push(f),e.app.processmanager.showRun(e.def.modulename,f),e.app.processmanager.fetchAll(),c&&c.call(e.view)},error:function(){}})},a.cpm.Module.prototype.internalSyncToSource=function(){this.def.source=YAML.stringify(this.def.module)},a.cpm.Module.prototype.internalSyncToModel=function(){this.def.module=YAML.parse(this.def.source)}}(window.vw=window.vw||{}),function(a){a.cpm.ModuleManager=function(b,c,d){this.initiated=!1,this.options=d,this.app=b,this.view=new a.cpm.ModuleManagerView(this,c),this.init(),this.moduletree={},this.modules={},this.modulesobj=[]},a.cpm.ModuleManager.prototype.init=function(){var a=this;a.fetchAll()},a.cpm.ModuleManager.prototype.fetchAll=function(){var a=this;$.ajax({type:"POST",url:a.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"module ls --json"},dataType:"json",success:function(b,c,d){a.moduletree=b,a.modules={},a.parseModuleTree(b),a.addDefaultModules(),a.view.refresh(),a.initiated=!0}})},a.cpm.ModuleManager.prototype.search=function(a,b){var c=this;$.ajax({type:"POST",url:c.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"module search --json",data:a},dataType:"json",success:function(a,d,e){b.call(c,a)},error:function(a){c.app.logger.error(a)}})},a.cpm.ModuleManager.prototype.addDefaultModules=function(){this.modules._CMD={module:{name:"_CMD",desc:"CMD",input:{CMD:{type:"VAL"},DOCKERFILE:{type:"VAL",value:"false"},CONTAINED:{type:"VAL",value:"false"}},output:{STDOUT:{type:"VAL"}},exec:[]},modulename:"_CMD",source:"",sourcepath:"/no/path"},this.modules._MAP={module:{name:"_MAP",desc:"MAP",input:{IN:{type:"DIR"},RUN:{type:"MODVAL+"},REGEX:{type:"VAL"},CHUNK_SIZE:{type:"VAL",value:"10"}},output:{},exec:[]},modulename:"_MAP",source:"",sourcepath:"/no/path"}},a.cpm.ModuleManager.prototype.parseModuleTree=function(a){if("object"==typeof a)if(a.constructor===Array)for(var b=a.length-1;b>=0;b--)this.parseModuleTree(a[b]);else a.hasOwnProperty("folder")&&a.folder?this.parseModuleTree(a.items):this.modules[a.modulename]=a},a.cpm.ModuleManager.prototype.fetch=function(a,b){var c=this;$.ajax({type:"POST",url:c.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"module info "+a+" --json"},dataType:"json",success:function(a,d,e){b.call(c,a)}})},a.cpm.ModuleManager.prototype.checkNameExist=function(a,b,c){var d=this,e=/^(_?[a-zA-Z][a-zA-Z0-9\-_]+(@[a-zA-Z0-9\-_]+)?)(#(?:\w|-)+)?$/,f=e.exec(a);return f?void $.ajax({type:"POST",url:d.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"module ls --name"},success:function(d,e,f){for(var g=d.split("\n"),h=0;h<g.length;h++)if(modname=g[h].trim(),modname==a)return void c.call();b.call()},error:function(){c.call()}}):void c.call()},a.cpm.ModuleManager.prototype.prepareCreateNewModule=function(){var b=this,c=new a.cpm.ui.Modal;$preconfig=$(a.cpm.ModuleManagerView.templatePreConfigAddNew),$preconfig.find(".create-module-preconfig-submit").click(function(){var a=$preconfig.find("input").val(),d="custom";b.checkNameExist(a,function(){c.close(),b.createNewModule(a,d)},function(){var a=c.getContainer();a.find(".error-message").remove(),a.prepend('<div class="error-message">Module name already exist or isn\'t allowed, please choose another name</div>')})}),c.open($preconfig)},a.cpm.ModuleManager.prototype.createNewModule=function(b,c){var d=this,e=d.app.view.createPanel(b,"","moduledef-"+b,new a.cpm.Command("m",b)),f={module:{name:b,desc:"please fill in a brief description",input:{},output:{},exec:[]},modulename:b,source:"name : "+b+"\n\ndesc : > \n  please fill in a brief description",sourcepath:d.app.cpmsettingsmanager.defaultModulesDir+"/custom/"+b+".module",creation:!0},g=new a.cpm.Module(d.app,e.$el.find(".frame-body"),f);g.view.render()},a.cpm.ModuleManager.prototype.showModule=function(b){var c=this,d=c.app.view.getPanelFromSID("moduledef-"+b,!1,b,new a.cpm.Command("m",b)),e=new a.cpm.Module(c.app,d.$el.find(".frame-body"),c.modules[b]);c.modulesobj.push(e),e.view.render(),d.focus()},a.cpm.ModuleManager.prototype.getModule=function(b){for(var c in modulesobj)if(modulesobj[c].def.modulename==b)return b;return new a.cpm.Module(me.app,void 0,me.modules[b])}}(window.vw=window.vw||{}),function(a){a.cpm.Process=function(b,c,d){this.app=b,this.init(d),this.view=new a.cpm.ProcessView(this,c)},a.cpm.Process.prototype.init=function(a){this.moduledef=a.moduledef,this.conf=a.runconf,this.runid=a.runid,this.info={},this.synced=!1},a.cpm.Process.prototype.sync=function(b){var c=this;a.cpm.ui.AjaxButton.start(b),$.ajax({type:"POST",data:{cmd:"process get "+c.runid},url:c.app.options.cpmbaseurl+"rest/cmd",dataType:"json",success:function(d,e,f){a.cpm.ui.AjaxButton.stop(b),c.info=d,c.synced=!0,c.view.refresh()},error:function(){a.cpm.ui.AjaxButton.stop(b),alert("could not parse process info json (run id = "+c.runid+")")}})},a.cpm.Process.prototype.getStatus=function(a){var b=this;$.ajax({type:"POST",data:{cmd:"process status "+b.runid+" --json"},url:b.app.options.cpmbaseurl+"rest/cmd",dataType:"json",success:function(c,d,e){a.call(b.view,c)},error:function(){alert("could not parse process info json (run id = "+b.runid+")")}})},a.cpm.Process.prototype["delete"]=function(b){var c=this;a.cpm.ui.AjaxButton.start(b),$.ajax({type:"POST",data:{cmd:"process del "+c.runid},url:c.app.options.cpmbaseurl+"rest/cmd",success:function(d){if(a.cpm.ui.AjaxButton.stop(b),"ok"==d){var e=c.app.view.getPanelFromContent(c.view.$el);e["delete"](),c.app.processmanager.remove(c.runid)}},error:function(){a.cpm.ui.AjaxButton.stop(b),c.app.logger.error("error when trying to delete process result "+c.runid)}})},a.cpm.Process.prototype.run=function(a,b,c){var d=this;d.app.logger.debug(a),b&&b.call(d.view)},a.cpm.Process.pConf2mConf=function(a){var b={};for(var c in a)"_RUN_DIR"!=c&&"_DEF_DIR"!=c&&(b[c]=a[c].value);return b},a.cpm.Process.prototype.rerun=function(){var b=this,c=a.cpm.Process.pConf2mConf(b.info.runconf),d=new a.cpm.Module(b.app,void 0,b.app.modulesmanager.modules[b.info.name]);d.run(c)}}(window.vw=window.vw||{}),function(a){a.cpm.ProcessManager=function(b,c,d){this.initiated=!1,this.options=d,this.app=b,this.view=new a.cpm.ProcessManagerView(this,c),this.init(),this.startedprocess=[],this.runs={}},a.cpm.ProcessManager.prototype.init=function(){var a=this;a.fetchAll()},a.cpm.ProcessManager.prototype.showRun=function(b,c){var d=this,e=this.app.view.getPanelFromSID("process-"+c,!1,'<span class="link">'+b+"</span> ( "+c+" )",new a.cpm.Command("p",{name:b,runid:c}));e.$el.find(".frame-title").find(".link").click(function(){d.app.modulesmanager.showModule(b)});var f=new a.cpm.Process(this.app,e.$el.find(".frame-body"),{moduledef:d.app.modulesmanager.modules[b].module,runconf:{},runid:c});f.sync(),e.focus()},a.cpm.ProcessManager.prototype.remove=function(a){var b=this,c=!1;for(runmodulename in b.runs){for(var d=0;d<b.runs[runmodulename].length;d++)if(b.runs[runmodulename][d].runid==a){b.runs[runmodulename].splice(d,1),0==b.runs[runmodulename].length&&delete b.runs[runmodulename],c=!0;break}if(c)break}b.view.refresh()},a.cpm.ProcessManager.prototype.fetchAll=function(a,b){var c=this;$.ajax({type:"POST",url:c.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"process ls -a"},dataType:"text",success:function(a,b,d){c.runs={};var e=a.split("\n");for(var f in e){var g=e[f].trim();if(""!=g){var h=g.split(":"),i=h[0].trim();regex=/(.*?)\((.*?)\)/;var j=regex.exec(h.slice(1).join(":").trim());if(!j)continue;var k=j[1].trim(),l=j[2].trim();c.runs.hasOwnProperty(i)?c.runs[i].push({runid:k,datecreated:l}):c.runs[i]=[{runid:k,datecreated:l}]}}c.view.refresh(),c.initiated=!0}})}}(window.vw=window.vw||{}),function(a){a.cpm.ServiceManager=function(b,c,d){this.initiated=!1,this.options=d,this.app=b,this.view=new a.cpm.ServiceManagerView(this,c),this.init(),this.services=[]},a.cpm.ServiceManager.prototype.init=function(){var a=this;a.fetchAll()},a.cpm.ServiceManager.prototype.showService=function(b){for(var c=this,d=c.services.length-1;d>=0;d--)if(c.services[d].name==b){var e=c.services[d],f=e.name;e.url&&(f='<a href="'+e.url+'" target="_blank">'+e.name+"</a>");var g=this.app.view.getPanelFromSID("service-"+b,!1,f,new a.cpm.Command("l",b));new a.cpm.ServiceView(this.app,g.$el.find(".frame-body"),e);break}g.focus()},a.cpm.ServiceManager.prototype.startService=function(b,c){var d=this;a.cpm.ui.AjaxButton.start(c),$.ajax({type:"POST",url:d.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"service start "+b.service.name},dataType:"json",success:function(e,f,g){a.cpm.ui.AjaxButton.stop(c),e.error?d.app.logger.error(e.error):(b.service.status=!0,d.view.refresh(),b.refresh())},error:function(){a.cpm.ui.AjaxButton.stop(c)}})},a.cpm.ServiceManager.prototype.stopService=function(b,c){var d=this;a.cpm.ui.AjaxButton.start(c),$.ajax({type:"POST",url:d.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"service stop "+b.service.name},dataType:"json",success:function(e,f,g){a.cpm.ui.AjaxButton.stop(c),e.error?d.app.logger.error(e.error):(b.service.status=!1,d.view.refresh(),b.refresh())},error:function(){a.cpm.ui.AjaxButton.stop(c)}})},a.cpm.ServiceManager.prototype.fetchAll=function(a,b){var c=this;$.ajax({type:"POST",url:c.app.options.cpmbaseurl+"rest/cmd",data:{cmd:"service ls"},dataType:"json",success:function(a,b,d){a.error?c.app.logger.error(a.error):(c.services=a,c.view.refresh(),c.initiated=!0)}})}}(window.vw=window.vw||{}),function(a){a.cpm.CLIView=function(a,b){this.$el=b,this.el=b[0],this.model=a,this.init(),this.panels=[]},a.cpm.CLIView.maxFrameHeight=500,a.cpm.CLIView.prototype.init=function(){var b=this;this.$fullscreencontainer=$(a.cpm.CLIView.fullscreentemplate),$("body").append(this.$fullscreencontainer),a.cpm.CLIView.maxFrameHeight=$(window).height()-178,$("#cmd-bar-container").perfectScrollbar({suppressScrollX:!0}),$("#active-content").css("height",window.innerHeight-94),$("#active-content").perfectScrollbar({suppressScrollX:!0}),$("#menu-content-body").css("height",window.innerHeight-80),$("#menu-content-body").perfectScrollbar({suppressScrollX:!0}),$(window).on("resize",function(){$("#menu-content-body").css("height",window.innerHeight-80),$("#menu-content-body").perfectScrollbar({suppressScrollX:!0}),$("#active-content").css("height",window.innerHeight-94),$("#active-content").perfectScrollbar({suppressScrollX:!0}),a.cpm.CLIView.maxFrameHeight=$(window).height()-178}),$("#log-button").click(function(){b.model.logger.view()}),this.contentpanel=$("#active-content"),this.cmdbar=$("#cmdbar").cmd({prompt:"$",width:"100%",commands:function(a){b.model.request($("<div>"+a+"</div>").text())}}),$("#cmdbar").on("mousedown",function(c){2==c.which&&a.cpm.currentTextSelection&&(b.cmdbar.insert(a.cpm.currentTextSelection),b.toggleCLI(!0))}),jQuery("#app-title").click(function(){b.toggleCLI(!1),"default"==b.model.activemenu?(jQuery(".menu-open").switchClass("menu-open","menu-closed"),jQuery(".menu-closed").switchClass("menu-closed","menu-open")):b.openMenu("default")}),$(".main-menu-item").click(function(){b.model.activemenu==this.id?(jQuery(".menu-open").switchClass("menu-open","menu-closed"),jQuery(".menu-closed").switchClass("menu-closed","menu-open")):b.openMenu(this.id)}),jQuery("#menu").click(function(){b.toggleCLI(!1)}),jQuery("#menu-content").on("click",function(){
b.toggleCLI(!1)}),jQuery("#active-content").on("click",function(){b.toggleCLI(!1)}),jQuery("#cmd-bar-container").on("click",function(){b.toggleCLI(!0)})},a.cpm.CLIView.prototype.closeMenu=function(){var a=this;a.model.activemenu="default",a.model.setActiveMenu("default"),jQuery(".menu-open").switchClass("menu-open","menu-closed")},a.cpm.CLIView.prototype.openMenu=function(a){var b=this;jQuery(".menu-closed").switchClass("menu-closed","menu-open"),b.model.setActiveMenu(a),b.model.activemenu=a},a.cpm.CLIView.prototype.setStatusButton=function(a){$("#status-button").removeClass(),$("#status-button").addClass("status-button-"+a),"limited"==a?$("#status-button").attr("title","Websocket does not seem to work. You can try to reconnect via the settings page. Some feature won't be available till then..."):$("#status-button").attr("title",void 0)},a.cpm.CLIView.prototype.toggleCLI=function(a){a?this.cmdbar.isenabled()||(this.cmdbar.enable(),this.cmdbar.focus()):this.cmdbar.isenabled()&&this.cmdbar.disable()},a.cpm.CLIView.prototype.refreshPanelList=function(){for(var a=this,b="",c=[],d=a.panels.length-1;d>=0;d--){var e=a.panels[d];c.push(e.serialize());var f=e.$el.find(".frame-title").text(),g="";e.cmd&&(g="panel-"+e.cmd.command+"-item"),b+='<div class="panel-item '+g+'" uid="'+e.uid+'" title="'+f+'">'+f+'</div><div class="panel-item-close" uid="'+e.uid+'"></div>'}store.set(a.model.options.cpmhost+"-panels",c),this.model.menus["default"].body.empty(),this.model.menus["default"].body.append(b),this.model.menus["default"].body.find(".panel-item").click(function(){var b=a.getPanelFromUID($(this).attr("uid"));b.focus()}),this.model.menus["default"].body.find(".panel-item-close").click(function(){var b=a.getPanelFromUID($(this).attr("uid"));b["delete"]()})},a.cpm.CLIView.prototype.getPanelFromSID=function(a,b,c,d){var e=this,f=-1;for(var g in e.panels)if(void 0!=e.panels[g].semanticid&&e.panels[g].semanticid==a){f=g;break}return-1!=f?e.panels[f]:b?void 0:e.createPanel(c,"",a,d)},a.cpm.CLIView.prototype.getPanel=function(a,b,c){var d=this,e=-1;for(var f in d.panels)if(d.panels[f].$el.find(".frame-title").html()==a){e=f;break}return-1!=e?d.panels[e]:b?void 0:d.createPanel(a,void 0,void 0,c)},a.cpm.CLIView.prototype.getPanelFromUID=function(a){var b=this,c=-1;for(var d in b.panels)if(b.panels[d].uid==a){c=d;break}return-1!=c?b.panels[c]:void 0},a.cpm.CLIView.prototype.getPanelFromContent=function(a){return this.getPanelFromUID(a.parents(".frame").attr("uid"))},a.cpm.CLIView.prototype.createPanel=function(b,c,d,e){var f=new a.cpm.Panel(this.model,b,c,d,e);return f},a.cpm.CLIView.fullscreentemplate='<div id="fullscreen-container"><div class="frame-header"><div class="frame-title"></div><div class="frame-tools"><div class="frame-tool frame-tool-quitfs"></div></div></div><div class="frame-body"></div></div>'}(window.vw=window.vw||{}),function(a){function b(a,b){var c=typeof a,d=typeof b;return a.hasOwnProperty("...")?-1:b.hasOwnProperty("...")?1:c!=d?"string"==c?-1:"string"==d?1:0:0}a.cpm.CorpusManagerView=function(a,b){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.model=a,this.init()},a.cpm.CorpusManagerView.prototype.init=function(){this.$el.empty();var a='<div class="treeview-fold treeview-unfolded" depth="0"><div class="treeview-node">Corpora</div><div id="corpora-corpora-container"></div></div><div class="treeview-fold treeview-unfolded" depth="0"><div class="treeview-node">Results</div><div id="corpora-results-container"></div></div>';this.$el.append(a),this.$el.find(".treeview-node").on("click",function(){var a=$(this).parent();if(a.hasClass("treeview-fold")){var b=a.children();a.hasClass("treeview-folded")?($(b[1]).slideDown(),a.removeClass("treeview-folded"),a.addClass("treeview-unfolded")):($(b[1]).slideUp(),a.removeClass("treeview-unfolded"),a.addClass("treeview-folded"))}})},a.cpm.CorpusManagerView.prototype.renderCorpora=function(a){var b=this,c=b.renderDirectory(a,b.model.app.cpmsettingsmanager.cpmsettings.corpus_dir,1);this.$el.find("#corpora-corpora-container").append(c)},a.cpm.CorpusManagerView.prototype.renderResults=function(a){var b=this,c=b.renderDirectory(a,b.model.app.cpmsettingsmanager.cpmsettings.result_dir,1);this.$el.find("#corpora-results-container").empty(),this.$el.find("#corpora-results-container").append(c)},a.cpm.CorpusManagerView.prototype.refresh=function(){var b=this,c=a.cpm.CorpusManagerView.renderSubTree(this.model.filetree.corpus,0,b.model.app.cpmsettingsmanager.cpmsettings.corpus_dir),d=a.cpm.CorpusManagerView.renderSubTree(this.model.filetree.results,0,b.model.app.cpmsettingsmanager.cpmsettings.result_dir);this.$el.html(c+d),this.$el.find(".treeview-node").on("click",function(){var a=$(this).parent();if(a.hasClass("treeview-fold")){var b=a.children();a.hasClass("treeview-folded")?($(b[1]).slideDown(),a.removeClass("treeview-folded"),a.addClass("treeview-unfolded")):($(b[1]).slideUp(),a.removeClass("treeview-unfolded"),a.addClass("treeview-folded"))}}),this.$el.find(".treeview-node").not(".treeview-more").draggable({appendTo:"body",opacity:.7,helper:"clone"}),this.$el.find(".treeview-leaf").not(".treeview-more").draggable({appendTo:"body",opacity:.7,helper:"clone"})},a.cpm.CorpusManagerView.renderSubTree=function(c,d,e){var f="";if("object"==typeof c)if(c.constructor===Array){c=c.sort(b);for(var g=c.length-1;g>=0;g--)f+=a.cpm.CorpusManagerView.renderSubTree(c[g],d,e)}else for(var g in c)if("..."==g)f+="file"==c[g]?'<div class="treeview-leaf treeview-more" style="margin-left:'+d+'px;" filepath="'+e+'">'+g+"</div>":'<div class="treeview-node treeview-more" style="margin-left:'+d+'px;" filepath="'+e+'">'+g+"</div>";else{var h="treeview-folded",i='style="display:none;"',j=g;0==d&&(h="treeview-unfolded",i="",j=""),f+='<div class="treeview-fold '+h+'"><div class="treeview-node" style="margin-left:'+d+'px;" filepath="'+e+j+'">'+g+"</div><div "+i+">"+a.cpm.CorpusManagerView.renderSubTree(c[g],d+14,e+j+"/")+"</div></div>"}else"string"==typeof c&&(f+='<div class="treeview-leaf" style="margin-left:'+d+'px;" filepath="'+e+c+'">'+c+"</div>");return f},a.cpm.CorpusManagerView.prototype.renderDirectory=function(a,b,c){for(var d=this,e=14*c,f="<div>",g=0;g<a.length;g++)if("object"==typeof a[g]){var h=_.first(_.keys(a[g]));f+="..."==h?'<div class="treeview-leaf treeview-more" style="margin-left:'+e+'px;" filepath="'+b+'" next="'+a[g][h]+'">'+h+"</div>":'<div class="treeview-fold treeview-folded" depth="'+c+'"><div class="treeview-node" style="margin-left:'+e+'px;" filepath="'+b+"/"+h+'">'+h+'</div><div style="display:none;"></div></div>'}else{var h=a[g];f+='<div class="treeview-leaf" style="margin-left:'+e+'px;" filepath="'+b+"/"+h+'">'+h+"</div>"}f+="</div>";var i=$(f);return i.find(".treeview-leaf").not(".treeview-more").click(function(){var a=$(this).attr("filepath");d.model.app.openFile(a)}),i.find(".treeview-more").click(function(){var a=this,b=$(this).attr("filepath"),c=$(this).parent(),e=$(this).attr("next"),f=0;$(a).addClass("treeview-leaf-waiting"),c.parent().hasClass("treeview-fold")&&(f=c.parent().attr("depth")),d.model.lsDir(b,e,function(b,c){var e=d.renderDirectory(b,c,parseInt(f)+1);$(a).removeClass("treeview-leaf-waiting"),$(a).replaceWith(e)})}),i.find(".treeview-node").click(function(){var a=this,b=$(this).attr("filepath"),c=$(this).parent(),e=0,f=0;$(a).addClass("treeview-node-waiting"),c.hasClass("treeview-fold")&&(f=c.attr("depth")),$(a).unbind("click"),d.model.lsDir(b,e,function(b,c){var e=d.renderDirectory(b,c,parseInt(f)+1),g=$(a).parent(".treeview-fold"),h=g.children();g.removeClass("treeview-folded"),g.addClass("treeview-unfolded"),$(a).removeClass("treeview-node-waiting"),$(h[1]).append(e),$(h[1]).slideDown(),$(a).on("click",function(){var a=$(this).parent();if(a.hasClass("treeview-fold")){var b=a.children();a.hasClass("treeview-folded")?($(b[1]).slideDown(),a.removeClass("treeview-folded"),a.addClass("treeview-unfolded")):($(b[1]).slideUp(),a.removeClass("treeview-unfolded"),a.addClass("treeview-folded"))}})})}),i.find(".treeview-node").not(".treeview-more").draggable({appendTo:"body",opacity:.7,helper:"clone"}),i.find(".treeview-leaf").not(".treeview-more").draggable({appendTo:"body",opacity:.7,helper:"clone"}),i.children()}}(window.vw=window.vw||{}),function(a){a.cpm.CPMSettingsManagerView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.CPMSettingsManagerView.prototype.init=function(){},a.cpm.CPMSettingsManagerView.prototype.render=function(){var a=this;this.$el.empty();var b=this.model.cpmsettings,c='<div><button class="cpm-refresh">Refresh</button></div>';c+='<div><button class="cpm-reconnect-ws">Reconnect (websockets)</button></div>',c+='<div class="settings-field-title"> Connection infos : </div>',c+='<div class="settings-field-body"><select id="server-chooser">';for(var d in a.model.app.options.servers){var e="";this.model.app.options.cpmhost==a.model.app.options.servers[d].CPM_HOST&&(e="selected"),c+='<option value="'+d+'" '+e+">"+d+"</option>"}c+="</select></div>",c+='<div class="settings-field-body"><div>AppFM Host : </div><input type="text" name="cpmhost" value="'+this.model.app.options.cpmhost+'"></div>',c+='<div class="settings-field-body"><div>AppFM Port : </div><input type="text" name="cpmport" value="'+this.model.app.options.cpmport+'"></div>',c+='<div class="settings-field-body"><div>AppFM WS Host+Port : </div><input type="text" name="cpwsmhost" value="'+this.model.app.options.cpmwshost+'"></div>',c+='<div class="settings-field-body"><button class="cpm-reconnect">Connect</button></div>',c+='<div class="settings-field-title"> Corpus directory : </div><div class="settings-field-body">'+b.corpus_dir+"</div>",c+='<div class="settings-field-title"> Result directory : </div><div class="settings-field-body">'+b.result_dir+"</div>";for(var f='<div class="settings-field-title"> Modules directories :</div><div class="settings-field-body"><ul>',g=b.modules.length-1;g>=0;g--)f+="<li ",f+=b.modules[g].exist?">":'class="warning-field">',f+=b.modules[g].name+"</li>";f+="</ul></div>",c+=f,this.$el.append(c),this.$el.find("#server-chooser").on("change",function(){var b=$(this).val();a.$el.find("input[name=cpmhost]").val(a.model.app.options.servers[b].CPM_HOST),a.$el.find("input[name=cpmport]").val(a.model.app.options.servers[b].CPM_PORT),a.$el.find("input[name=cpwsmhost]").val(a.model.app.options.servers[b].CPM_WS_HOST)}),this.$el.find(".cpm-reconnect").click(function(){var b=a.$el.find("input[name=cpmhost]").val(),c=a.$el.find("input[name=cpmport]").val(),d=a.$el.find("input[name=cpwsmhost]").val();a.model.updateConnection(b,c,d)}),this.$el.find(".cpm-refresh").click(function(){a.model.app.reload()}),this.$el.find(".cpm-reconnect-ws").click(function(){a.model.app.initWS()})}}(window.vw=window.vw||{}),function(a){a.cpm.HelpManagerView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.HelpManagerView.prototype.init=function(){var b=this;this.$el.append(a.cpm.HelpManagerView.template),this.$el.find("#help-main-wiki-page").on("click",function(){b.model.app.openIFrame(b.model.app.options.cpmbaseurl+"/dokuwiki/","Wiki")}),this.$el.find("#help-presa-slides").on("click",function(){b.model.app.openIFrame(b.model.app.options.cpmbaseurl+"/introslides","Intro")}),this.$el.find("#help-presa-overview").on("click",function(){b.model.app.openIFrame(b.model.app.options.cpmbaseurl+"/public/doc/appfm-overview.pdf","AppFM Overview")}),this.$el.find("#help-tutorial").on("click",function(){b.model.app.demo()})},a.cpm.HelpManagerView.template='<div id="help-tutorial" style="cursor:pointer;">Tutorial</div><div id="help-presa-slides" style="cursor:pointer;">Introduction slides</div><div id="help-presa-overview" style="cursor:pointer;">Architecture/Features Overview</div><div id="help-main-wiki-page" style="cursor:pointer;">Main wiki</div>'}(window.vw=window.vw||{}),function(a){a.cpm.ModuleInputView=draw2d.shape.basic.Circle.extend({NAME:"Input",init:function(a,b){this._super({stroke:3,color:"#3d3d3d",bgColor:"#3dff3d"}),this.port=this.createPort("output",new draw2d.layout.locator.RightLocator(this)),this.label=new draw2d.shape.basic.Label({text:a}),this.add(this.label,new draw2d.layout.locator.BottomLocator(this));var c=b;c.name=a,this.setUserData(c)},info:function(){var a="";("_RUN_DIR"==this.userData.name||"_DEF_DIR"==this.userData.name)&&(a=" disabled ");var b="";this.userData.type&&(b=this.userData.type);var c="";this.userData.format&&(c=this.userData.format);var d="";this.userData.schema&&(d=this.userData.schema);var e="";this.userData.value&&(e=this.userData.value);var f='<div>Type : <input class="mv-info-type" type="text" value="'+b+'"'+a+"></div>",g='<div>Format : <input class="mv-info-format" type="text" value="'+c+'"'+a+"></div>",h='<div>Schema : <input class="mv-info-schema" type="text" value="'+d+'"'+a+"></div>",i='<div>Default value : <input class="mv-info-value" type="text" value="'+e+'"'+a+"></div>";return $('<div><div>Name : <input class="mv-info-name" type="text" value="'+this.userData.name+'"'+a+"></div>"+f+g+h+i+"</div>")}}),a.cpm.ModuleOutputView=draw2d.shape.basic.Circle.extend({NAME:"Output",init:function(a,b){this._super({stroke:3,color:"#3d3d3d",bgColor:"#3dff3d"}),this.port=this.createPort("input",new draw2d.layout.locator.LeftLocator(this)),this.label=new draw2d.shape.basic.Label({text:a}),this.add(this.label,new draw2d.layout.locator.BottomLocator(this));var c=b;c.name=a,this.setUserData(c)},info:function(){var a="";this.userData.type&&(a=this.userData.type);var b="";this.userData.format&&(b=this.userData.format);var c="";this.userData.schema&&(c=this.userData.schema);var d="";this.userData.value&&(d=this.userData.value);var e='<div>Type : <input class="mv-info-type" type="text" value="'+a+'"></div>',f='<div>Format : <input class="mv-info-format" type="text" value="'+b+'"></div>',g='<div>Schema : <input class="mv-info-schema" type="text" value="'+c+'"></div>',h='<div>Return value : <input class="mv-info-value" type="text" value="'+d+'"></div>';return $('<div><div>Name : <input class="mv-info-name" type="text" value="'+this.userData.name+'"></div>'+e+f+g+h+"</div>")}}),a.cpm.ModuleConnectionView=function(a,b,c){var d=new draw2d.Connection;d.setStroke(2),d.setOutlineStroke(1),d.setOutlineColor("#303030"),d.setRouter(null),d.setColor("#91B93E"),d.setSource(a),d.setTarget(b);var e=c;return d.setUserData({value:e}),d.info=function(){return $("<div>"+this.userData.value+"</div>")},d},a.cpm.ModuleMapBoxView=draw2d.shape.composite.Raft.extend({NAME:"ModuleMAP",init:function(a,b,c,d){this._super({width:200,height:200});var e=this.createPort("hybrid",new draw2d.layout.locator.LeftLocator(this));e.setName("input_"+b+"_IN")},info:function(){return $("<div>map</div>")}}),a.cpm.ModuleBoxView=draw2d.shape.layout.VerticalLayout.extend({NAME:"Module",init:function(a,b,c,d){this._super(),this.setUserData({def:a,name:b,moduleval:c,namespace:d}),this.inputports={},this.outputports={},console.log(a),console.log(c),this.setBackgroundColor("#f4f4f4"),this.setStroke(1),this.setColor("#e0e0e0"),this.setRadius(1);var e=this.createLabel(b).setStroke(0);this.label=e;var f=new draw2d.shape.basic.Rectangle;f.getHeight=function(){return 1},f.setMinWidth(90),f.setColor("#e0e0e0"),this.add(e),this.add(f);for(var g in a.module.input){var h=this.createLabel(g);h.setMinHeight(30),h.setStroke(0),h.setBackgroundColor(null),h.setFontColor("#a0a0a0");var i=h.createPort("input",new draw2d.layout.locator.LeftLocator(h));i.setName("input_"+b+"_"+g),this.inputports[g]=i,this.add(h)}for(var j in a.module.output){var k=this.createLabel(j);k.setMinHeight(30),k.setStroke(0),k.setBackgroundColor(null),k.setFontColor("#a0a0a0");var i=k.createPort("output",new draw2d.layout.locator.RightLocator(k));i.setName("output_"+b+"_"+j),this.outputports[j]=i,this.add(k)}},createLabel:function(a){var b=new draw2d.shape.basic.Label({text:a,padding:{left:10,top:3,right:10,bottom:5},resizeable:!0});return b.setStroke(1),b.setRadius(0),b.setBackgroundColor(null),b.setColor(this.bgColor.darker(.2)),b.onDoubleClick=function(a){},b},info:function(){var a="";for(var b in this.userData.moduleval.input)a+="<div>"+b+' : <input type="text" style="width:90%;" value="'+this.userData.moduleval.input[b]+'"></div>';var c="";if("_CMD"!=this.userData.def.modulename&&"_MAP"!=this.userData.def.modulename)for(var d in this.userData.def.module.output)c+="<div>"+d+' : <input type="text" style="width:90%;" value="'+this.userData.def.module.output[d].value+'" disabled></div>';var e="";return this.userData.namespace&&(e=this.userData.namespace),$('<div><div class="mv-info-title">'+this.userData.def.modulename+'</div><div>Namespace : <input type="text" value="'+e+'"></div><div style="font-size:1.45em;">Inputs</div>'+a+'<div style="font-size:1.45em;">Outputs</div>'+c+"</div>")}})}(window.vw=window.vw||{}),function(a){function b(a,b){var c=typeof a,d=typeof b;return a.hasOwnProperty("folder")&&a.folder?1:b.hasOwnProperty("folder")&&b.folder?-1:c!=d?"string"==c?-1:"string"==d?1:0:0}a.cpm.ModuleManagerView=function(b,c){this.id=a.cpm.utils.guid(),this.$el=c||$("<div></div>"),this.el=this.$el[0],this.model=b,this.init()},a.cpm.ModuleManagerView.prototype.init=function(){var b=this;$mastercontainer=$(a.cpm.ModuleManagerView.template),b.$el.empty(),b.$el.append($mastercontainer),b.$el.find("#modulemanager-menu").append('<div id="modulemanager-add-new">Create a new module</div>'),b.$el.find("#modulemanager-menu").append('<input id="modulemanager-search" type="text">'),b.$el.find("#modulemanager-add-new").click(function(){b.model.prepareCreateNewModule()}),b.$el.find("#modulemanager-search").on("keyup",function(a){if(27==a.keyCode)b.showAll(),$(this).val("");else{var c=$(this).val().trim();c?b.model.search(c,function(a){b.show(a)}):b.showAll()}})},a.cpm.ModuleManagerView.prototype.showAll=function(){this.$el.find(".treeview-leaf").each(function(a,b){var c=$(b);c.hasClass("search-hidden")?c.removeClass("search-hidden"):c.hasClass("search-result")&&c.removeClass("search-result")}),this.$el.find(".treeview-node").each(function(a,b){$(b).hasClass("search-hidden")&&$(b).removeClass("search-hidden")})},a.cpm.ModuleManagerView.prototype.show=function(a){this.$el.find(".treeview-leaf").each(function(b,c){var d=$(c);if(-1==a.indexOf(d.html().trim()))d.hasClass("search-hidden")||d.addClass("search-hidden"),d.hasClass("search-result")&&d.removeClass("search-result");else{d.hasClass("search-hidden")&&d.removeClass("search-hidden"),d.hasClass("search-result")||d.addClass("search-result");var e=d.parents(".treeview-module-folder-content");e.each(function(a,b){var c=$(b),d=c.parent();d.hasClass("treeview-folded")&&(c.show(),d.removeClass("treeview-folded"),d.addClass("treeview-unfolded"))})}}),this.$el.find(".treeview-node").each(function(a,b){$(b).hasClass("search-hidden")||$(b).addClass("search-hidden")})},a.cpm.ModuleManagerView.prototype.refresh=function(){var b=this;this.$el.find("#modulemanager-list").html(a.cpm.ModuleManagerView.renderSubTree(this.model.moduletree,0)),this.$el.find(".treeview-node").on("click",function(){var a=$(this).parent();if(a.hasClass("treeview-fold")){var b=a.children();a.hasClass("treeview-folded")?($(b[1]).slideDown(),a.removeClass("treeview-folded"),a.addClass("treeview-unfolded")):($(b[1]).slideUp(),a.removeClass("treeview-unfolded"),a.addClass("treeview-folded"))}}),this.$el.find(".treeview-leaf").on("click",function(){var a=$(this).html();b.model.showModule(a)}),this.$el.find(".treeview-leaf").draggable({appendTo:"body",opacity:.7,helper:"clone"}),this.$el.find(".treeview-leaf").droppable()},a.cpm.ModuleManagerView.renderSubTree=function(c,d){var e="",f=14;if("object"==typeof c)if(c.constructor===Array){c=c.sort(b);for(var g=c.length-1;g>=0;g--)e+=a.cpm.ModuleManagerView.renderSubTree(c[g],d)}else if(c.hasOwnProperty("folder")&&c.folder)if(""!=c.foldername){var h="treeview-folded",i='style="display:none;"';3>d/f&&(h="treeview-unfolded",i=""),e+='<div class="treeview-fold '+h+'"><div class="treeview-node treeview-module-folder" style="margin-left:'+d+'px;">'+c.foldername+'</div><div class="treeview-module-folder-content" '+i+">"+a.cpm.ModuleManagerView.renderSubTree(c.items,d+f)+"</div></div>"}else e+=a.cpm.ModuleManagerView.renderSubTree(c.items,d);else e+=c.hasOwnProperty("module")?'<div class="treeview-leaf treeview-module-item draw2d_droppable" data-modname="'+c.module.name+'" style="margin-left:'+d+'px;">'+c.module.name+"</div>":'<div class="treeview-leaf treeview-module-item" style="margin-left:'+d+'px; color:red;">'+c.modulename+"</div>";return e},a.cpm.ModuleManagerView.template='<div><div id="modulemanager-menu"></div><div id="modulemanager-list"></div></div>',a.cpm.ModuleManagerView.templatePreConfigAddNew='<div><div style="padding:12px;"><div>Choose a name for your new module (allowed form : [a-zA-Z][a-zA-Z0-9-_]+(@[a-zA-Z0-9-_]+)? ): <input type="text"></div><button class="create-module-preconfig-submit" type="button">Ok</button><div style="margin-top:24px; font-size:0.75em;">For more information about how to create modules refer to help pages.</div></div></div>'}(window.vw=window.vw||{}),function(a){a.cpm.ModuleView=function(b,c){this.id=a.cpm.utils.guid(),this.model=b,c&&(this.$el=c||$("<div></div>"),this.el=this.$el[0],this.init())},a.cpm.ModuleView.prototype.init=function(){var b=this;this.$el.empty(),this.$el.append(a.cpm.ModuleView.template),this.$el.find(".module-view-infos-panel").perfectScrollbar({suppressScrollX:!0}),b.renderSource(),b.setActiveMenu(".module-view-source"),this.$el.find(".module-view-source").on("click",function(){b.$el.find(".module-content-view").empty(),b.renderSource(),b.setActiveMenu(".module-view-source")}),this.$el.find(".module-save").on("click",function(){b.model.sync(function(){b.init(),b.model.app.logger.info("successfully saved"),b.$el.find(".module-save").addClass("success-action"),setTimeout(function(){b.$el.find(".module-save").removeClass("success-action")},2e3)},function(){b.init(),b.model.app.logger.error("couldn't save. error happend!")})}),this.$el.find(".module-run").on("click",function(){b.$el.find(".module-content-view").empty(),b.renderRunConfForm(),b.setActiveMenu(".module-run")})},a.cpm.ModuleView.prototype.setActiveMenu=function(a){this.$el.find(".module-header-item").removeClass("active"),this.$el.find(a).addClass("active")},a.cpm.ModuleView.prototype.render=function(){},a.cpm.ModuleView.prototype.renderSource=function(){var a=this,b=a.model.def.source;a.model.def.error&&this.$el.find(".module-content-view").append('<div class="error-msg">'+a.model.def.error+"</div>"),this.$el.find(".module-content-view").append('<div id="source-'+this.id+'" class="module-source-editor"></div>'),this.$el.find("#source-"+this.id).append(b),this.editor=ace.edit("source-"+this.id);var c=ace.require("ace/mode/yaml").Mode;0==a.model.def.modulename.indexOf("_")&&this.setReadOnly(!0),this.editor.getSession().setTabSize(2),this.editor.getSession().setUseSoftTabs(!0),this.editor.session.setMode(new c),this.$el.on("fullscreenOn",function(){a.$el.find(".module-source-editor").height(a.$el.find(".module-view-container").height()-a.$el.find(".module-header").height()),a.editor.resize()}),this.$el.on("fullscreenOff",function(){a.$el.find(".module-source-editor").height(a.$el.find(".module-view-container").height()-a.$el.find(".module-header").height()),a.editor.resize()})},a.cpm.ModuleView.prototype.renderRunConfForm=function(){var a=this;$form=$("<div></div>");var b=a.model.def.module.input;for(var c in b)$form.append('<div class="module-run-conf-form-field"><span style="font-weight:bold">'+c+'</span><span style="font-style:italic;"> ('+b[c].type+')</span><input type="text" value="" name="'+c+'"></div>');$form.append('<center><button class="submit" type="button">Run</button></center>'),this.$el.find(".module-content-view").append($form),$form.find("input").droppable({drop:function(a,b){$(this).val(b.draggable.attr("filepath"))}}),$form.find(".submit").on("click",function(){var c={};for(var d in b){var e=$form.find('input[name="'+d+'"]').val();""!=e.trim()&&(c[d]=e)}a.model.run(c,function(){a.$el.find(".module-content-view").empty(),a.renderSource(),a.setActiveMenu(".module-view-source")})})},a.cpm.ModuleView.prototype.showGraphical=function(){var a=this;a.$el.find(".module-content-view").empty(),a.model.def.hasOwnProperty("module")?a.renderGraphical():a.$el.find(".module-content-view").append("Unable to display graphical view of this module, definition contains error, please correct source file before")},a.cpm.ModuleView.prototype.renderGraphical=function(){return},a.cpm.ModuleView.prototype.showInfo=function(a){},a.cpm.ModuleView.prototype.exportViewToModelObj=function(){for(var a=this,b=0;b<a.canvas.figures.data.length;b++)a.canvas.figures.data[b];for(var b=0;b<a.canvas.lines.data.length;b++)a.canvas.lines.data[b]},a.cpm.ModuleView.prototype.createConnections=function(){for(var b=0;b<this.boundVariables.length;b++)if(console.log(this.boundVariables[b]),this.availableVariables[this.boundVariables[b].name]){var c=this.availableVariables[this.boundVariables[b].name],d=new a.cpm.ModuleConnectionView(c,this.boundVariables[b].ref,this.boundVariables[b].raw);this.canvas.add(d)}},a.cpm.ModuleView.getInputVars=function(b,c,d){var e=[];for(var f in b){var g=b[f];if("object"==typeof g)if(g.constructor===Array)for(var h=0;h<g.length;h++)e=e.concat(a.cpm.utils.extractVars(g[h],d.inputports[f]));else for(var h in g)e=e.concat(a.cpm.utils.extractVars(g[h],d.inputports[f]));else e=e.concat(a.cpm.utils.extractVars(g,d.inputports[f]))}return e},a.cpm.ModuleView.getOutputVars=function(a,b,c,d,e,f){var g="";f&&(g=f+".");for(var h in a.module.output)d[g+b+"."+h]=c.outputports[h];return d},a.cpm.ModuleView.templateGraphical='<div><div class="module-view-toolbox"><span class="module-view-toolbox-item mvti-cmd">+ CMD</span><span class="module-view-toolbox-item mvti-map">+ MAP</span><span class="module-view-toolbox-item mvti-input">+ Input</span><span class="module-view-toolbox-item mvti-output">+ Output</span></div><div class="canvas-container"><div class="canvas-view"></div></div><div class="module-view-infos-panel"></div></div>',a.cpm.ModuleView.template='<div class="module-view-container"><div class="module-header"><span class="module-view-source module-header-item" style="float:left; margin-left:8px; text-shadow:1px 1px #999999">source</span><span class="module-save module-header-item" style="float:left; margin-left:8px; text-shadow:1px 1px #999999">save</span><span class="module-run module-header-item" style="float:left; margin-left:8px; text-shadow:1px 1px #999999">run</span></div><div class="module-content-view"></div></div>',a.cpm.ModuleView.templateGraphic='<div class="module-graphical-view"><div ></div>'}(window.vw=window.vw||{}),function(a){a.cpm.Panel=function(b,c,d,e,f){this.app=b,this.semanticid=e,this.$el=$(a.cpm.Panel.frametemplate),this.app.view.contentpanel.find("#active-content-flow").prepend(this.$el),this.el=this.$el[0],this.uid=a.cpm.Panel.uids++,this.cmd=f,this.init(c,d)},a.cpm.Panel.prototype.init=function(b,c){var d=this;this.$el.attr("uid",this.uid),"undefined"!=b&&d.$el.find(".frame-title").append(b),"undefined"!=c&&d.$el.find(".frame-body").append(c),this.app.view.panels.push(d),this.app.view.refreshPanelList(),d.$el.find(".frame-title").mouseup(function(b){a.cpm.currentTextSelection=a.cpm.utils.getSelectionText()}),d.$el.find(".frame-body").mouseup(function(b){a.cpm.currentTextSelection=a.cpm.utils.getSelectionText()}),d.$el.find(".frame-body").perfectScrollbar({wheelPropagation:!0}),d.$el.find(".frame-tool-pin").click(function(){d.stick()}),d.$el.find(".frame-tool-close").click(function(){d["delete"]()}),d.$el.find(".frame-tool-openfs").click(function(){d.fullscreen()}),d.$el.find(".frame-tool-hide").click(function(){d.hide()}),d.app.view.contentpanel[0].scrollTop=0,d.app.view.contentpanel.perfectScrollbar("update")},a.cpm.Panel.prototype.quitFullscreen=function(){var a=this;a.$el.removeClass("fullscreen"),a.$el.find(".frame-body").trigger("fullscreenOff"),a.$el.find(".frame-tool-quitfs").remove(),a.$el.find(".frame-tools").children().show();var b=a.$el.find(".frame-body").children().not(".ps-scrollbar-x-rail").not(".ps-scrollbar-y-rail");1==b.length&&b.prop("originalHeight")&&b.height(b.prop("originalHeight"));var c=a.$el.find(".frame-body");c.height(c.prop("originalHeight")),c.perfectScrollbar("update"),a.$el.find(".frame-body").trigger("fullscreenOff")},a.cpm.Panel.prototype.fullscreen=function(){var a=this;a.$el.addClass("fullscreen"),a.$el.find(".frame-body").trigger("fullscreenOn"),a.$el.find(".frame-tools").children().hide(),a.$el.find(".frame-tools").append('<div class="frame-tool frame-tool-quitfs"></div>');var b=a.$el.find(".frame-body").children().not(".ps-scrollbar-x-rail").not(".ps-scrollbar-y-rail");1==b.length&&(b.prop("originalHeight",b.height()),b.height($(window).height()-100));var c=a.$el.find(".frame-body");c.prop("originalHeight",c.height()),c.height($(window).height()-70),c.perfectScrollbar("update"),a.$el.find(".frame-tool-quitfs").on("click",function(){a.quitFullscreen()}),a.$el.find(".frame-body").trigger("fullscreenOn")},a.cpm.Panel.prototype.serialize=function(){return{cmd:this.cmd,uid:this.uid,sid:this.semanticid}},a.cpm.Panel.deserialize=function(b,c){var d=new a.cpm.Command(c.cmd.command,c.cmd.data),e=d.execute(b);return e},a.cpm.Panel.prototype.show=function(){var a=this,b=a.$el.find(".frame-tool-show");b.removeClass("frame-tool-show"),b.addClass("frame-tool-hide"),b.unbind("click"),a.$el.find(".frame-body").slideDown({complete:function(){b.on("click",function(){a.hide()})}})},a.cpm.Panel.prototype.hide=function(){var a=this,b=a.$el.find(".frame-tool-hide");b.removeClass("frame-tool-hide"),b.addClass("frame-tool-show"),b.unbind("click"),a.$el.find(".frame-body").slideUp({complete:function(){b.on("click",function(){a.show()})}})},a.cpm.Panel.prototype.focus=function(){var a=this;a.app.view.contentpanel[0].scrollTop=a.$el[0].offsetTop-20},a.cpm.Panel.prototype["delete"]=function(){var a=this,b=a.app.view.panels.indexOf(a);-1!=b&&(a.app.view.panels.splice(b,1),a.app.view.refreshPanelList()),a.exitCB&&a.exitCB.call(),a.$el.animate({opacity:.25,height:"toggle"},{complete:function(){a.$el.remove()},duration:200})},a.cpm.Panel.prototype.stick=function(){var a=this;this.app.view.contentpanel.find("#active-content-sticky").append(a.$el);var b=a.$el.find(".frame-tool-pin");b.removeClass("frame-tool-pin"),b.addClass("frame-tool-unpin"),b.unbind("click"),b.click(function(){a.unstick()}),a.app.view.contentpanel[0].scrollTop=0,a.app.view.contentpanel.perfectScrollbar("update")},a.cpm.Panel.prototype.unstick=function(){var a=this;this.app.view.contentpanel.find("#active-content-flow").append(a.$el);var b=a.$el.find(".frame-tool-unpin");b.removeClass("frame-tool-unpin"),b.addClass("frame-tool-pin"),b.unbind("click"),b.click(function(){a.stick()})},a.cpm.Panel.prototype.addToolButton=function(a){a.addClass("frame-tool"),this.$el.find(".frame-tools").append(a)},a.cpm.Panel.prototype.removeToolButton=function(a){this.$el.find(".frame-tools").find(a).remove()},a.cpm.Panel.uids=0,a.cpm.Panel.maxFrameHeight=650,a.cpm.Panel.frametemplate='<div class="frame"><div class="frame-header"><div class="frame-title"></div><div class="frame-tools"><div class="frame-tool frame-tool-close"></div><div class="frame-tool frame-tool-pin"></div><div class="frame-tool frame-tool-openfs"></div><div class="frame-tool frame-tool-hide"></div></div></div><div class="frame-body"></div></div>'}(window.vw=window.vw||{}),function(a){a.cpm.ProcessManagerView=function(a,b){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.model=a,this.init()},a.cpm.ProcessManagerView.prototype.init=function(){var a=this;a.$el.empty()},a.cpm.ProcessManagerView.prototype.refresh=function(){var a=this,b="";for(var c in a.model.runs){b+='<div><div class="settings-field-title" style="cursor:pointer;">'+c+'</div><div class="settings-field-body"><ul class="run-list" style="font-size:12px;">';
for(var d in a.model.runs[c])b+='<li runid="'+a.model.runs[c][d].runid+'">'+a.model.runs[c][d].datecreated+"</li>";b+="</ul></div></div>"}a.$el.empty(),a.$el.append(b),a.$el.find(".settings-field-title").on("click",function(){$(this).parent().find(".settings-field-body").toggle()}),a.$el.find(".settings-field-body li").on("click",function(){a.model.showRun($(this).parents(".settings-field-body").prev().html().trim(),$(this).attr("runid"))})}}(window.vw=window.vw||{}),function(a){a.cpm.ProcessView=function(a,b){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.model=a,this.init()},a.cpm.ProcessView.prototype.init=function(){var b=this;this.$el.empty(),this.$el.append(a.cpm.ProcessView.template),this.shared={};var c=b.model.app.view.getPanelFromContent(this.$el);c&&(c.exitCB=function(){clearInterval(b.shared.interval)})},a.cpm.ProcessView.prototype.refresh=function(){var b=this;if(b.model.synced){b.$el.find(".run-status .info-box-content").html("<div>"+b.model.info.status+'</div><div class="process-detailed-status"></div><button class="processresult-rerun" type="button">re-run</button><button class="processresult-refresh" type="button">refresh</button><button class="processresult-log" type="button">log</button><button class="processresult-delete" type="button">delete</button>'),b.$el.find(".run-status .info-box-content .processresult-rerun").on("click",function(){b.model.rerun()}),b.$el.find(".run-status .info-box-content .processresult-refresh").on("click",function(){b.model.sync($(this))}),b.$el.find(".run-status .info-box-content .processresult-delete").on("click",function(){b.model["delete"]($(this))}),b.$el.find(".processresult-log").on("click",function(){b.model.app.request("process log "+b.model.runid)});var c="<ul>";for(var d in b.model.info.runconf)c+='<li><span style="font-weight:bold;">'+d+" : </span><span>"+a.cpm.ProcessView.printVar(b.model.info.runconf[d],d)+"</span></li>";c+="</ul>",b.$el.find(".run-config .info-box-content").html(c);var e="<ul>";for(var d in b.model.info.env)b.model.info.runconf.hasOwnProperty(d)||(e+='<li><span style="font-weight:bold;">'+d+" : </span><span>"+a.cpm.ProcessView.printVar(b.model.info.env[d],d)+"</span></li>");for(var d in b.model.info.parentEnv)b.model.info.runconf.hasOwnProperty(d)||(e+='<li><span style="font-weight:bold;">'+d+" : </span><span>"+a.cpm.ProcessView.printVar(b.model.info.parentEnv[d],d)+"</span></li>");e+="</ul>",b.$el.find(".run-results .info-box-content").html(e),b.$el.find(".file-var").click(function(){b.model.app.openFile($(this).html().trim())}),b.$el.find(".iframe-var").click(function(){b.model.app.openIFrame($(this).html().trim())}),b.shared.interval&&clearInterval(b.shared.interval),b.shared.interval=setInterval(function(){b.model.getStatus(function(a){a.exited?clearInterval(b.shared.interval):b.$el.find(".process-detailed-status").html('<code><pre class="pre-wrapped">'+a.info+"</pre></code>")})},2e3),b.$el.find(".info-box").each(function(a){$(this).find(".info-box-title").click(function(){$(this).parent().find(".info-box-content").toggle()})})}},a.cpm.ProcessView.printVar=function(b,c){if("FILE"==b.type)return'<span class="file-var link">'+b.value+"</span>";if("FILE*"==b.type){for(var d="<ul>",e=0;e<b.value.length;e++)d+='<li class="file-var link">'+b.value[e]+"</li>";return d+="</ul>"}if("VAL"==b.type&&"url"==b.format){var d='<span class="iframe-var" name="'+c+'">'+b.value.replace("localhost",a.cpm.INSTANCE.options.cpmhost)+"</span>";return d}return"string"==typeof b.value&&"html"==b.format?b.value:JSON.stringify(b.value).replace("/\n/","<br>").replace("/s/","&nbsp;").replace('/\\"/','"')},a.cpm.ProcessView.template='<div class="run-status info-box"><div class="info-box-title">Status</div> <div class="info-box-content"></div></div><div class="run-config info-box"><div class="info-box-title">Config</div><div class="info-box-content"></div></div><div class="run-results info-box"><div class="info-box-title">Results</div> <div class="info-box-content"></div></div>'}(window.vw=window.vw||{}),function(a){a.cpm.ServiceManagerView=function(a,b){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.model=a,this.init()},a.cpm.ServiceManagerView.prototype.init=function(){var a=this;a.$el.empty()},a.cpm.ServiceManagerView.prototype.refresh=function(){var a=this,b="";for(var c in a.model.services){var d=a.model.services[c],e="";d.status&&(e="active"),b+='<div class="service '+e+'"><div class="service-name">'+d.name+"</div></div>"}a.$el.empty(),a.$el.append(b),a.$el.find(".service-name").on("click",function(){a.model.showService($(this).html().trim())})},a.cpm.ServiceView=function(a,b,c){this.$el=b||$("<div></div>"),this.el=this.$el[0],this.service=c,this.app=a,this.refresh()},a.cpm.ServiceView.prototype.refresh=function(){var b=this;this.$el.empty(),this.service.desc&&this.$el.append("<div>"+this.service.desc+"</div>"),this.$el.append("<div> Status : "+(this.service.status?"running":"stopped")+"</div>"),this.service.status?this.$el.append("<div><button>Stop</button></div>"):this.$el.append("<div><button>Start</button></div>"),this.$el.find("button").click(function(){$(this).hasClass("ajax-submitted")||(b.service.status?b.app.servicemanager.stopService(b,$(this)):b.app.servicemanager.startService(b,$(this)))});var c="<ul>";b.service.log&&(c+="<li><span>log : </span>"+b.service.log);for(var d in b.service.outputs)c+="<li><span>"+d+" : </span>"+a.cpm.ProcessView.printVar(b.service.outputs[d],d);c+="</ul>",this.$el.append(c),b.$el.find(".iframe-var").click(function(){b.app.openIFrame($(this).html().trim(),b.service.name+" "+$(this).attr("name"))})}}(window.vw=window.vw||{});